var Sr=new Map;function Cn(t){let e=Array.isArray(t)?t:[t],n=e.join(","),r=Sr.get(n)??(()=>{let i=_n(e),s=Xi(i);return Sr.set(n,s),s})();return i=>r(i)}function _n(t){return Array.isArray(t)?t.map(e=>e.split(":")):[t.split(":")]}function Xi(t){let e=t.flatMap(i=>Zi(i,wn(i))),n=ts(e),r=ns(n);return i=>!!r(i.update,i)}function wn(t){let e=It,n=[t].flatMap(r=>{let[i,s,o]=r;if(!(i in Pr))return[r];if(!i&&!s&&!o)return[r];let u=Pr[i].map(d=>[d,s,o]);return s===void 0||s in yn&&(s||o)?u:u.filter(([d])=>!!e[d]?.[s])}).flatMap(r=>{let[i,s,o]=r;if(!(s in yn))return[r];if(!s&&!o)return[r];let u=yn[s].map(d=>[i,d,o]);return o===void 0?u:u.filter(([,d])=>!!e[i]?.[d]?.[o])});if(n.length===0)throw new Error(`Shortcuts in '${t.join(":")}' do not expand to any valid filter query`);return n}function Zi(t,e){if(e.length===0)throw new Error("Empty filter query given");let n=e.map(es).filter(r=>r!==!0);if(n.length===0)return e;throw n.length===1?new Error(n[0]):new Error(`Invalid filter query '${t.join(":")}'. There are ${n.length} errors after expanding the contained shortcuts: ${n.join("; ")}`)}function es(t){let[e,n,r,...i]=t;if(e===void 0)return"Empty filter query given";if(!(e in It||e==="chat_boost"||e==="removed_chat_boost")){let a=Object.keys(It);return`Invalid L1 filter '${e}' given in '${t.join(":")}'. Permitted values are: ${a.map(u=>`'${u}'`).join(", ")}.`}if(n===void 0)return!0;let s=It[e];if(!(n in s)){let a=Object.keys(s);return`Invalid L2 filter '${n}' given in '${t.join(":")}'. Permitted values are: ${a.map(u=>`'${u}'`).join(", ")}.`}if(r===void 0)return!0;let o=s[n];if(!(r in o)){let a=Object.keys(o);return`Invalid L3 filter '${r}' given in '${t.join(":")}'. ${a.length===0?`No further filtering is possible after '${e}:${n}'.`:`Permitted values are: ${a.map(u=>`'${u}'`).join(", ")}.`}`}return i.length===0?!0:`Cannot filter further than three levels, ':${i.join(":")}' is invalid!`}function ts(t){let e={};for(let[n,r,i]of t){let s=e[n]??={};if(r!==void 0){let o=s[r]??=new Set;i!==void 0&&o.add(i)}}return e}function gn(t,e){return(n,r)=>t(n,r)||e(n,r)}function Rr(t,e){return(n,r)=>{let i=t(n,r);return i&&e(i,r)}}function Mr(t){return(e,n)=>t(e,n)!=null}function ns(t){let e=Object.entries(t).map(([n,r])=>{let i=o=>o[n],s=Object.entries(r).map(([o,a])=>{let u=h=>h[o],d=Array.from(a).map(h=>h==="me"?(l,f)=>{let y=f.me.id;return kr(l,m=>m.id===y)}:l=>kr(l,f=>f[h]||f.type===h));return d.length===0?Mr(u):Rr(u,d.reduce(gn))});return s.length===0?Mr(i):Rr(i,s.reduce(gn))});if(e.length===0)throw new Error("Cannot create filter function for empty query");return e.reduce(gn)}function kr(t,e){let n=r=>r!=null&&e(r);return Array.isArray(t)?t.some(n):n(t)}var Tr={mention:{},hashtag:{},cashtag:{},bot_command:{},url:{},email:{},phone_number:{},bold:{},italic:{},underline:{},strikethrough:{},spoiler:{},code:{},pre:{},text_link:{},text_mention:{},custom_emoji:{}},fn={me:{},is_bot:{},is_premium:{},added_to_attachment_menu:{}},rs={user:{},hidden_user:{},chat:{},channel:{}},is={is_video:{},is_animated:{},premium_animation:{}},bn={emoji:{},custom_emoji:{}},Or={forward_origin:rs,is_topic_message:{},is_automatic_forward:{},text:{},animation:{},audio:{},document:{},photo:{},sticker:is,story:{},video:{},video_note:{},voice:{},contact:{},dice:{},game:{},poll:{},venue:{},location:{},entities:Tr,caption_entities:Tr,caption:{},has_media_spoiler:{},new_chat_title:{},new_chat_photo:{},delete_chat_photo:{},message_auto_delete_timer_changed:{},pinned_message:{},invoice:{},proximity_alert_triggered:{},video_chat_scheduled:{},video_chat_started:{},video_chat_ended:{},video_chat_participants_invited:{},web_app_data:{}},Ir={...Or,sender_boost_count:{},new_chat_members:fn,left_chat_member:fn,group_chat_created:{},supergroup_chat_created:{},migrate_to_chat_id:{},migrate_from_chat_id:{},successful_payment:{},boost_added:{},users_shared:{},chat_shared:{},connected_website:{},write_access_allowed:{},passport_data:{},forum_topic_created:{},forum_topic_edited:{name:{},icon_custom_emoji_id:{}},forum_topic_closed:{},forum_topic_reopened:{},general_forum_topic_hidden:{},general_forum_topic_unhidden:{}},Er={...Or,channel_chat_created:{}},ss={data:{},game_short_name:{}},Fr={from:fn},os={old_reaction:bn,new_reaction:bn},as={reactions:bn},It={message:Ir,edited_message:Ir,channel_post:Er,edited_channel_post:Er,inline_query:{},chosen_inline_result:{},callback_query:ss,shipping_query:{},pre_checkout_query:{},poll:{},poll_answer:{},my_chat_member:Fr,chat_member:Fr,chat_join_request:{},message_reaction:os,message_reaction_count:as},Pr={"":["message","channel_post"],msg:["message","channel_post"],edit:["edited_message","edited_channel_post"]},yn={"":["entities","caption_entities"],media:["photo","video"],file:["photo","animation","audio","document","video","video_note","voice","sticker"]};var me={filterQuery(t){let e=Cn(t);return n=>e(n)},text(t){let e=me.filterQuery([":text",":caption"]),n=tt(t);return r=>{if(!e(r))return!1;let i=r.message??r.channelPost,s=i.text??i.caption;return nt(r,s,n)}},command(t){let e=me.filterQuery(":entities:bot_command"),n=new Set,r=new Set;return Et(t).forEach(i=>{if(i.startsWith("/"))throw new Error(`Do not include '/' when registering command handlers (use '${i.substring(1)}' not '${i}')`);(i.includes("@")?n:r).add(i)}),i=>{if(!e(i))return!1;let s=i.message??i.channelPost,o=s.text??s.caption;return s.entities.some(a=>{if(a.type!=="bot_command"||a.offset!==0)return!1;let u=o.substring(1,a.length);if(r.has(u)||n.has(u))return i.match=o.substring(u.length+1).trimStart(),!0;let d=u.indexOf("@");if(d===-1)return!1;let h=u.substring(d+1).toLowerCase(),c=i.me.username.toLowerCase();if(h!==c)return!1;let l=u.substring(0,d);return r.has(l)?(i.match=o.substring(u.length+1).trimStart(),!0):!1})}},reaction(t){let e=me.filterQuery("message_reaction"),n=typeof t=="string"?[{type:"emoji",emoji:t}]:(Array.isArray(t)?t:[t]).map(r=>typeof r=="string"?{type:"emoji",emoji:r}:r);return r=>{if(!e(r))return!1;let{old_reaction:i,new_reaction:s}=r.messageReaction;for(let o of s){let a=!1;if(o.type==="emoji"){for(let u of i)if(u.type==="emoji"&&u.emoji===o.emoji){a=!0;break}}else if(o.type==="custom_emoji"){for(let u of i)if(u.type==="custom_emoji"&&u.custom_emoji_id===o.custom_emoji_id){a=!0;break}}if(!a)if(o.type==="emoji"){for(let u of n)if(u.type==="emoji"&&u.emoji===o.emoji)return!0}else if(o.type==="custom_emoji"){for(let u of n)if(u.type==="custom_emoji"&&u.custom_emoji_id===o.custom_emoji_id)return!0}else return!0}return!1}},chatType(t){let e=new Set(Et(t));return n=>n.chat?.type!==void 0&&e.has(n.chat.type)},callbackQuery(t){let e=me.filterQuery("callback_query:data"),n=tt(t);return r=>e(r)&&nt(r,r.callbackQuery.data,n)},gameQuery(t){let e=me.filterQuery("callback_query:game_short_name"),n=tt(t);return r=>e(r)&&nt(r,r.callbackQuery.game_short_name,n)},inlineQuery(t){let e=me.filterQuery("inline_query"),n=tt(t);return r=>e(r)&&nt(r,r.inlineQuery.query,n)},chosenInlineResult(t){let e=me.filterQuery("chosen_inline_result"),n=tt(t);return r=>e(r)&&nt(r,r.chosenInlineResult.result_id,n)}},q=class t{constructor(e,n,r){this.update=e;this.api=n;this.me=r}match;get message(){return this.update.message}get editedMessage(){return this.update.edited_message}get channelPost(){return this.update.channel_post}get editedChannelPost(){return this.update.edited_channel_post}get messageReaction(){return this.update.message_reaction}get messageReactionCount(){return this.update.message_reaction_count}get inlineQuery(){return this.update.inline_query}get chosenInlineResult(){return this.update.chosen_inline_result}get callbackQuery(){return this.update.callback_query}get shippingQuery(){return this.update.shipping_query}get preCheckoutQuery(){return this.update.pre_checkout_query}get poll(){return this.update.poll}get pollAnswer(){return this.update.poll_answer}get myChatMember(){return this.update.my_chat_member}get chatMember(){return this.update.chat_member}get chatJoinRequest(){return this.update.chat_join_request}get chatBoost(){return this.update.chat_boost}get removedChatBoost(){return this.update.removed_chat_boost}get msg(){return this.message??this.editedMessage??this.callbackQuery?.message??this.channelPost??this.editedChannelPost}get chat(){return(this.msg??this.messageReaction??this.messageReactionCount??this.myChatMember??this.chatMember??this.chatJoinRequest??this.chatBoost??this.removedChatBoost)?.chat}get senderChat(){return this.msg?.sender_chat}get from(){return this.messageReaction?.user??(this.callbackQuery??this.inlineQuery??this.shippingQuery??this.preCheckoutQuery??this.chosenInlineResult??this.msg??this.myChatMember??this.chatMember??this.chatJoinRequest)?.from}get inlineMessageId(){return this.callbackQuery?.inline_message_id??this.chosenInlineResult?.inline_message_id}entities(e){let n=this.msg;if(n===void 0)return[];let r=n.text??n.caption;if(r===void 0)return[];let i=n.entities??n.caption_entities;if(i===void 0)return[];if(e!==void 0){let s=new Set(Et(e));i=i.filter(o=>s.has(o.type))}return i.map(s=>({...s,text:r.substring(s.offset,s.offset+s.length)}))}reactions(){let e=[],n=[],r=[],i=[],s=[],o=[],a=[],u=[],d=this.messageReaction;if(d!==void 0){let{old_reaction:h,new_reaction:c}=d;for(let l of c)l.type==="emoji"?e.push(l.emoji):l.type==="custom_emoji"&&s.push(l.custom_emoji_id);for(let l of h)l.type==="emoji"?i.push(l.emoji):l.type==="custom_emoji"&&u.push(l.custom_emoji_id);n.push(...e),o.push(...s);for(let l=0;l<i.length;l++){let f=n.length;if(f===0)break;let y=i[l];for(let m=0;m<f;m++)if(y===n[m]){r.push(y),i.splice(l,1),n.splice(m,1),l--;break}}for(let l=0;l<u.length;l++){let f=o.length;if(f===0)break;let y=u[l];for(let m=0;m<f;m++)if(y===o[m]){a.push(y),u.splice(l,1),o.splice(m,1),l--;break}}}return{emoji:e,emojiAdded:n,emojiKept:r,emojiRemoved:i,customEmoji:s,customEmojiAdded:o,customEmojiKept:a,customEmojiRemoved:u}}static has=me;has(e){return t.has.filterQuery(e)(this)}hasText(e){return t.has.text(e)(this)}hasCommand(e){return t.has.command(e)(this)}hasReaction(e){return t.has.reaction(e)(this)}hasChatType(e){return t.has.chatType(e)(this)}hasCallbackQuery(e){return t.has.callbackQuery(e)(this)}hasGameQuery(e){return t.has.gameQuery(e)(this)}hasInlineQuery(e){return t.has.inlineQuery(e)(this)}hasChosenInlineResult(e){return t.has.chosenInlineResult(e)(this)}reply(e,n,r){return this.api.sendMessage(g(this.chat,"sendMessage").id,e,n,r)}forwardMessage(e,n,r){return this.api.forwardMessage(e,g(this.chat,"forwardMessage").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"forwardMessage"),n,r)}forwardMessages(e,n,r,i){return this.api.forwardMessages(e,g(this.chat,"forwardMessages").id,n,r,i)}copyMessage(e,n,r){return this.api.copyMessage(e,g(this.chat,"copyMessage").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"copyMessage"),n,r)}copyMessages(e,n,r,i){return this.api.copyMessages(e,g(this.chat,"copyMessages").id,n,r,i)}replyWithPhoto(e,n,r){return this.api.sendPhoto(g(this.chat,"sendPhoto").id,e,n,r)}replyWithAudio(e,n,r){return this.api.sendAudio(g(this.chat,"sendAudio").id,e,n,r)}replyWithDocument(e,n,r){return this.api.sendDocument(g(this.chat,"sendDocument").id,e,n,r)}replyWithVideo(e,n,r){return this.api.sendVideo(g(this.chat,"sendVideo").id,e,n,r)}replyWithAnimation(e,n,r){return this.api.sendAnimation(g(this.chat,"sendAnimation").id,e,n,r)}replyWithVoice(e,n,r){return this.api.sendVoice(g(this.chat,"sendVoice").id,e,n,r)}replyWithVideoNote(e,n,r){return this.api.sendVideoNote(g(this.chat,"sendVideoNote").id,e,n,r)}replyWithMediaGroup(e,n,r){return this.api.sendMediaGroup(g(this.chat,"sendMediaGroup").id,e,n,r)}replyWithLocation(e,n,r,i){return this.api.sendLocation(g(this.chat,"sendLocation").id,e,n,r,i)}editMessageLiveLocation(e,n,r,i){let s=this.inlineMessageId;return s!==void 0?this.api.editMessageLiveLocationInline(s,e,n,r):this.api.editMessageLiveLocation(g(this.chat,"editMessageLiveLocation").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageLiveLocation"),e,n,r,i)}stopMessageLiveLocation(e,n){let r=this.inlineMessageId;return r!==void 0?this.api.stopMessageLiveLocationInline(r,e):this.api.stopMessageLiveLocation(g(this.chat,"stopMessageLiveLocation").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"stopMessageLiveLocation"),e,n)}replyWithVenue(e,n,r,i,s,o){return this.api.sendVenue(g(this.chat,"sendVenue").id,e,n,r,i,s,o)}replyWithContact(e,n,r,i){return this.api.sendContact(g(this.chat,"sendContact").id,e,n,r,i)}replyWithPoll(e,n,r,i){return this.api.sendPoll(g(this.chat,"sendPoll").id,e,n,r,i)}replyWithDice(e,n,r){return this.api.sendDice(g(this.chat,"sendDice").id,e,n,r)}react(e,n,r){return this.api.setMessageReaction(g(this.chat,"setMessageReaction").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"setMessageReaction"),typeof e=="string"?[{type:"emoji",emoji:e}]:(Array.isArray(e)?e:[e]).map(i=>typeof i=="string"?{type:"emoji",emoji:i}:i),n,r)}replyWithChatAction(e,n,r){return this.api.sendChatAction(g(this.chat,"sendChatAction").id,e,n,r)}getUserProfilePhotos(e,n){return this.api.getUserProfilePhotos(g(this.from,"getUserProfilePhotos").id,e,n)}getUserChatBoosts(e,n){return this.api.getUserChatBoosts(e,g(this.from,"getUserChatBoosts").id,n)}getFile(e){let n=g(this.msg,"getFile"),r=n.photo!==void 0?n.photo[n.photo.length-1]:n.animation??n.audio??n.document??n.video??n.video_note??n.voice??n.sticker;return this.api.getFile(g(r,"getFile").file_id,e)}kickAuthor(...e){return this.banAuthor(...e)}banAuthor(e,n){return this.api.banChatMember(g(this.chat,"banAuthor").id,g(this.from,"banAuthor").id,e,n)}kickChatMember(...e){return this.banChatMember(...e)}banChatMember(e,n,r){return this.api.banChatMember(g(this.chat,"banChatMember").id,e,n,r)}unbanChatMember(e,n,r){return this.api.unbanChatMember(g(this.chat,"unbanChatMember").id,e,n,r)}restrictAuthor(e,n,r){return this.api.restrictChatMember(g(this.chat,"restrictAuthor").id,g(this.from,"restrictAuthor").id,e,n,r)}restrictChatMember(e,n,r,i){return this.api.restrictChatMember(g(this.chat,"restrictChatMember").id,e,n,r,i)}promoteAuthor(e,n){return this.api.promoteChatMember(g(this.chat,"promoteAuthor").id,g(this.from,"promoteAuthor").id,e,n)}promoteChatMember(e,n,r){return this.api.promoteChatMember(g(this.chat,"promoteChatMember").id,e,n,r)}setChatAdministratorAuthorCustomTitle(e,n){return this.api.setChatAdministratorCustomTitle(g(this.chat,"setChatAdministratorAuthorCustomTitle").id,g(this.from,"setChatAdministratorAuthorCustomTitle").id,e,n)}setChatAdministratorCustomTitle(e,n,r){return this.api.setChatAdministratorCustomTitle(g(this.chat,"setChatAdministratorCustomTitle").id,e,n,r)}banChatSenderChat(e,n){return this.api.banChatSenderChat(g(this.chat,"banChatSenderChat").id,e,n)}unbanChatSenderChat(e,n){return this.api.unbanChatSenderChat(g(this.chat,"unbanChatSenderChat").id,e,n)}setChatPermissions(e,n){return this.api.setChatPermissions(g(this.chat,"setChatPermissions").id,e,n)}exportChatInviteLink(e){return this.api.exportChatInviteLink(g(this.chat,"exportChatInviteLink").id,e)}createChatInviteLink(e,n){return this.api.createChatInviteLink(g(this.chat,"createChatInviteLink").id,e,n)}editChatInviteLink(e,n,r){return this.api.editChatInviteLink(g(this.chat,"editChatInviteLink").id,e,n,r)}revokeChatInviteLink(e,n){return this.api.revokeChatInviteLink(g(this.chat,"editChatInviteLink").id,e,n)}approveChatJoinRequest(e,n){return this.api.approveChatJoinRequest(g(this.chat,"approveChatJoinRequest").id,e,n)}declineChatJoinRequest(e,n){return this.api.declineChatJoinRequest(g(this.chat,"declineChatJoinRequest").id,e,n)}setChatPhoto(e,n){return this.api.setChatPhoto(g(this.chat,"setChatPhoto").id,e,n)}deleteChatPhoto(e){return this.api.deleteChatPhoto(g(this.chat,"deleteChatPhoto").id,e)}setChatTitle(e,n){return this.api.setChatTitle(g(this.chat,"setChatTitle").id,e,n)}setChatDescription(e,n){return this.api.setChatDescription(g(this.chat,"setChatDescription").id,e,n)}pinChatMessage(e,n,r){return this.api.pinChatMessage(g(this.chat,"pinChatMessage").id,e,n,r)}unpinChatMessage(e,n){return this.api.unpinChatMessage(g(this.chat,"unpinChatMessage").id,e,n)}unpinAllChatMessages(e){return this.api.unpinAllChatMessages(g(this.chat,"unpinAllChatMessages").id,e)}leaveChat(e){return this.api.leaveChat(g(this.chat,"leaveChat").id,e)}getChat(e){return this.api.getChat(g(this.chat,"getChat").id,e)}getChatAdministrators(e){return this.api.getChatAdministrators(g(this.chat,"getChatAdministrators").id,e)}getChatMembersCount(...e){return this.getChatMemberCount(...e)}getChatMemberCount(e){return this.api.getChatMemberCount(g(this.chat,"getChatMemberCount").id,e)}getAuthor(e){return this.api.getChatMember(g(this.chat,"getAuthor").id,g(this.from,"getAuthor").id,e)}getChatMember(e,n){return this.api.getChatMember(g(this.chat,"getChatMember").id,e,n)}setChatStickerSet(e,n){return this.api.setChatStickerSet(g(this.chat,"setChatStickerSet").id,e,n)}deleteChatStickerSet(e){return this.api.deleteChatStickerSet(g(this.chat,"deleteChatStickerSet").id,e)}createForumTopic(e,n,r){return this.api.createForumTopic(g(this.chat,"createForumTopic").id,e,n,r)}editForumTopic(e,n){let r=g(this.msg,"editForumTopic"),i=g(r.message_thread_id,"editForumTopic");return this.api.editForumTopic(r.chat.id,i,e,n)}closeForumTopic(e){let n=g(this.msg,"closeForumTopic"),r=g(n.message_thread_id,"closeForumTopic");return this.api.closeForumTopic(n.chat.id,r,e)}reopenForumTopic(e){let n=g(this.msg,"reopenForumTopic"),r=g(n.message_thread_id,"reopenForumTopic");return this.api.reopenForumTopic(n.chat.id,r,e)}deleteForumTopic(e){let n=g(this.msg,"deleteForumTopic"),r=g(n.message_thread_id,"deleteForumTopic");return this.api.deleteForumTopic(n.chat.id,r,e)}unpinAllForumTopicMessages(e){let n=g(this.msg,"unpinAllForumTopicMessages"),r=g(n.message_thread_id,"unpinAllForumTopicMessages");return this.api.unpinAllForumTopicMessages(n.chat.id,r,e)}editGeneralForumTopic(e,n){return this.api.editGeneralForumTopic(g(this.chat,"editGeneralForumTopic").id,e,n)}closeGeneralForumTopic(e){return this.api.closeGeneralForumTopic(g(this.chat,"closeGeneralForumTopic").id,e)}reopenGeneralForumTopic(e){return this.api.reopenGeneralForumTopic(g(this.chat,"reopenGeneralForumTopic").id,e)}hideGeneralForumTopic(e){return this.api.hideGeneralForumTopic(g(this.chat,"hideGeneralForumTopic").id,e)}unhideGeneralForumTopic(e){return this.api.unhideGeneralForumTopic(g(this.chat,"unhideGeneralForumTopic").id,e)}unpinAllGeneralForumTopicMessages(e){return this.api.unpinAllGeneralForumTopicMessages(g(this.chat,"unpinAllGeneralForumTopicMessages").id,e)}answerCallbackQuery(e,n){return this.api.answerCallbackQuery(g(this.callbackQuery,"answerCallbackQuery").id,typeof e=="string"?{text:e}:e,n)}setChatMenuButton(e,n){return this.api.setChatMenuButton(e,n)}getChatMenuButton(e,n){return this.api.getChatMenuButton(e,n)}setMyDefaultAdministratorRights(e,n){return this.api.setMyDefaultAdministratorRights(e,n)}getMyDefaultAdministratorRights(e,n){return this.api.getMyDefaultAdministratorRights(e,n)}editMessageText(e,n,r){let i=this.inlineMessageId;return i!==void 0?this.api.editMessageTextInline(i,e,n):this.api.editMessageText(g(this.chat,"editMessageText").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageText"),e,n,r)}editMessageCaption(e,n){let r=this.inlineMessageId;return r!==void 0?this.api.editMessageCaptionInline(r,e):this.api.editMessageCaption(g(this.chat,"editMessageCaption").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageCaption"),e,n)}editMessageMedia(e,n,r){let i=this.inlineMessageId;return i!==void 0?this.api.editMessageMediaInline(i,e,n):this.api.editMessageMedia(g(this.chat,"editMessageMedia").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageMedia"),e,n,r)}editMessageReplyMarkup(e,n){let r=this.inlineMessageId;return r!==void 0?this.api.editMessageReplyMarkupInline(r,e):this.api.editMessageReplyMarkup(g(this.chat,"editMessageReplyMarkup").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageReplyMarkup"),e,n)}stopPoll(e,n){return this.api.stopPoll(g(this.chat,"stopPoll").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"stopPoll"),e,n)}deleteMessage(e){return this.api.deleteMessage(g(this.chat,"deleteMessage").id,g(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"deleteMessage"),e)}deleteMessages(e,n){return this.api.deleteMessages(g(this.chat,"deleteMessages").id,e,n)}replyWithSticker(e,n,r){return this.api.sendSticker(g(this.chat,"sendSticker").id,e,n,r)}getCustomEmojiStickers(e){return this.api.getCustomEmojiStickers((this.msg?.entities??[]).filter(n=>n.type==="custom_emoji").map(n=>n.custom_emoji_id),e)}answerInlineQuery(e,n,r){return this.api.answerInlineQuery(g(this.inlineQuery,"answerInlineQuery").id,e,n,r)}replyWithInvoice(e,n,r,i,s,o,a,u){return this.api.sendInvoice(g(this.chat,"sendInvoice").id,e,n,r,i,s,o,a,u)}answerShippingQuery(e,n,r){return this.api.answerShippingQuery(g(this.shippingQuery,"answerShippingQuery").id,e,n,r)}answerPreCheckoutQuery(e,n,r){return this.api.answerPreCheckoutQuery(g(this.preCheckoutQuery,"answerPreCheckoutQuery").id,e,typeof n=="string"?{error_message:n}:n,r)}setPassportDataErrors(e,n){return this.api.setPassportDataErrors(g(this.from,"setPassportDataErrors").id,e,n)}replyWithGame(e,n,r){return this.api.sendGame(g(this.chat,"sendGame").id,e,n,r)}};function g(t,e){if(t===void 0)throw new Error(`Missing information for API call to ${e}`);return t}function tt(t){return Et(t).map(e=>typeof e=="string"?n=>n===e?e:null:n=>n.match(e))}function nt(t,e,n){for(let r of n){let i=r(e);if(i)return t.match=i,!0}return!1}function Et(t){return Array.isArray(t)?t:[t]}var Ae=class extends Error{constructor(n,r){super(us(n));this.error=n;this.ctx=r;this.name="BotError",n instanceof Error&&(this.stack=n.stack)}};function us(t){let e;if(t instanceof Error)e=`${t.name} in middleware: ${t.message}`;else{let n=typeof t;switch(e=`Non-error value of type ${n} thrown in middleware`,n){case"bigint":case"boolean":case"number":case"symbol":e+=`: ${t}`;break;case"string":e+=`: ${String(t).substring(0,50)}`;break;default:e+="!";break}}return e}function rt(t){return typeof t=="function"?t:(e,n)=>t.middleware()(e,n)}function Lr(t,e){return async(n,r)=>{let i=!1;await t(n,async()=>{if(i)throw new Error("`next` already called before!");i=!0,await e(n,r)})}}function vn(t,e){return e()}var ls=()=>Promise.resolve();async function xn(t,e){await t(e,ls)}var it=class t{handler;constructor(...e){this.handler=e.length===0?vn:e.map(rt).reduce(Lr)}middleware(){return this.handler}use(...e){let n=new t(...e);return this.handler=Lr(this.handler,rt(n)),n}on(e,...n){return this.filter(q.has.filterQuery(e),...n)}hears(e,...n){return this.filter(q.has.text(e),...n)}command(e,...n){return this.filter(q.has.command(e),...n)}reaction(e,...n){return this.filter(q.has.reaction(e),...n)}chatType(e,...n){return this.filter(q.has.chatType(e),...n)}callbackQuery(e,...n){return this.filter(q.has.callbackQuery(e),...n)}gameQuery(e,...n){return this.filter(q.has.gameQuery(e),...n)}inlineQuery(e,...n){return this.filter(q.has.inlineQuery(e),...n)}chosenInlineResult(e,...n){return this.filter(q.has.chosenInlineResult(e),...n)}filter(e,...n){let r=new t(...n);return this.branch(e,r,vn),r}drop(e,...n){return this.filter(async r=>!await e(r),...n)}fork(...e){let n=new t(...e),r=rt(n);return this.use((i,s)=>Promise.all([s(),xn(r,i)])),n}lazy(e){return this.use(async(n,r)=>{let i=await e(n),s=Array.isArray(i)?i:[i];await rt(new t(...s))(n,r)})}route(e,n,r=vn){return this.lazy(async i=>{let s=await e(i);return(s===void 0||!n[s]?r:n[s])??[]})}branch(e,n,r){return this.lazy(async i=>await e(i)?n:r)}errorBoundary(e,...n){let r=new t(...n),i=rt(r);return this.use(async(s,o)=>{let a=!1,u=()=>(a=!0,Promise.resolve());try{await i(s,u)}catch(d){a=!1,await e(new Ae(d,s),u)}a&&await o()}),r}};var Qe=1e3,Ue=Qe*60,Ke=Ue*60,Se=Ke*24,ds=Se*7,cs=Se*365.25,hs=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return ps(t);if(n==="number"&&isFinite(t))return e.long?gs(t):ms(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function ps(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*cs;case"weeks":case"week":case"w":return n*ds;case"days":case"day":case"d":return n*Se;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Ke;case"minutes":case"minute":case"mins":case"min":case"m":return n*Ue;case"seconds":case"second":case"secs":case"sec":case"s":return n*Qe;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function ms(t){var e=Math.abs(t);return e>=Se?Math.round(t/Se)+"d":e>=Ke?Math.round(t/Ke)+"h":e>=Ue?Math.round(t/Ue)+"m":e>=Qe?Math.round(t/Qe)+"s":t+"ms"}function gs(t){var e=Math.abs(t);return e>=Se?Ft(t,e,Se,"day"):e>=Ke?Ft(t,e,Ke,"hour"):e>=Ue?Ft(t,e,Ue,"minute"):e>=Qe?Ft(t,e,Qe,"second"):t+" ms"}function Ft(t,e,n,r){var i=e>=n*1.5;return Math.round(t/n)+" "+r+(i?"s":"")}var jr=hs;function Qr(){throw new Error("setTimeout has not been defined")}function Ur(){throw new Error("clearTimeout has not been defined")}var ge=Qr,ye=Ur,Be;typeof window<"u"?Be=window:typeof self<"u"?Be=self:Be={};typeof Be.setTimeout=="function"&&(ge=setTimeout);typeof Be.clearTimeout=="function"&&(ye=clearTimeout);function Kr(t){if(ge===setTimeout)return setTimeout(t,0);if((ge===Qr||!ge)&&setTimeout)return ge=setTimeout,setTimeout(t,0);try{return ge(t,0)}catch{try{return ge.call(null,t,0)}catch{return ge.call(this,t,0)}}}function ys(t){if(ye===clearTimeout)return clearTimeout(t);if((ye===Ur||!ye)&&clearTimeout)return ye=clearTimeout,clearTimeout(t);try{return ye(t)}catch{try{return ye.call(null,t)}catch{return ye.call(this,t)}}}var re=[],qe=!1,Re,Pt=-1;function fs(){!qe||!Re||(qe=!1,Re.length?re=Re.concat(re):Pt=-1,re.length&&Dr())}function Dr(){if(!qe){var t=Kr(fs);qe=!0;for(var e=re.length;e;){for(Re=re,re=[];++Pt<e;)Re&&Re[Pt].run();Pt=-1,e=re.length}Re=null,qe=!1,ys(t)}}function bs(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];re.push(new Br(t,e)),re.length===1&&!qe&&Kr(Dr)}function Br(t,e){this.fun=t,this.array=e}Br.prototype.run=function(){this.fun.apply(null,this.array)};var Cs="browser",_s="browser",ws=!0,vs=[],xs="",As={},Ss={},Rs={};function Me(){}var Ms=Me,ks=Me,Ts=Me,Is=Me,Es=Me,Fs=Me,Ps=Me;function Os(t){throw new Error("process.binding is not supported")}function Ls(){return"/"}function js(t){throw new Error("process.chdir is not supported")}function Qs(){return 0}var De=Be.performance||{},Us=De.now||De.mozNow||De.msNow||De.oNow||De.webkitNow||function(){return new Date().getTime()};function Ks(t){var e=Us.call(De)*.001,n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n=n-t[0],r=r-t[1],r<0&&(n--,r+=1e9)),[n,r]}var Ds=new Date;function Bs(){var t=new Date,e=t-Ds;return e/1e3}var An={nextTick:bs,title:Cs,browser:ws,env:{NODE_ENV:"production"},argv:vs,version:xs,versions:As,on:Ms,addListener:ks,once:Ts,off:Is,removeListener:Es,removeAllListeners:Fs,emit:Ps,binding:Os,cwd:Ls,chdir:js,umask:Qs,hrtime:Ks,platform:_s,release:Ss,config:Rs,uptime:Bs};function qs(t,e,n){return n={path:e,exports:{},require:function(r,i){return Ns(r,i??n.path)}},t(n,n.exports),n.exports}function Ns(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}function $s(t){n.debug=n,n.default=n,n.coerce=u,n.disable=s,n.enable=i,n.enabled=o,n.humanize=jr,n.destroy=d,Object.keys(t).forEach(h=>{n[h]=t[h]}),n.names=[],n.skips=[],n.formatters={};function e(h){let c=0;for(let l=0;l<h.length;l++)c=(c<<5)-c+h.charCodeAt(l),c|=0;return n.colors[Math.abs(c)%n.colors.length]}n.selectColor=e;function n(h){let c,l=null,f,y;function m(...p){if(!m.enabled)return;let b=m,C=Number(new Date),_=C-(c||C);b.diff=_,b.prev=c,b.curr=C,c=C,p[0]=n.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let w=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(v,S)=>{if(v==="%%")return"%";w++;let M=n.formatters[S];if(typeof M=="function"){let L=p[w];v=M.call(b,L),p.splice(w,1),w--}return v}),n.formatArgs.call(b,p),(b.log||n.log).apply(b,p)}return m.namespace=h,m.useColors=n.useColors(),m.color=n.selectColor(h),m.extend=r,m.destroy=n.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(f!==n.namespaces&&(f=n.namespaces,y=n.enabled(h)),y),set:p=>{l=p}}),typeof n.init=="function"&&n.init(m),m}function r(h,c){let l=n(this.namespace+(typeof c>"u"?":":c)+h);return l.log=this.log,l}function i(h){n.save(h),n.namespaces=h,n.names=[],n.skips=[];let c,l=(typeof h=="string"?h:"").split(/[\s,]+/),f=l.length;for(c=0;c<f;c++)l[c]&&(h=l[c].replace(/\*/g,".*?"),h[0]==="-"?n.skips.push(new RegExp("^"+h.slice(1)+"$")):n.names.push(new RegExp("^"+h+"$")))}function s(){let h=[...n.names.map(a),...n.skips.map(a).map(c=>"-"+c)].join(",");return n.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let c,l;for(c=0,l=n.skips.length;c<l;c++)if(n.skips[c].test(h))return!1;for(c=0,l=n.names.length;c<l;c++)if(n.names[c].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function u(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Hs=$s,ie=qs(function(t,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=n,e.storage=o(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;let d="color: "+this.color;u.splice(1,0,d,"color: inherit");let h=0,c=0;u[0].replace(/%[a-zA-Z%]/g,l=>{l!=="%%"&&(h++,l==="%c"&&(c=h))}),u.splice(c,0,d)}e.log=console.debug||console.log||(()=>{});function i(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function s(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof An<"u"&&"env"in An&&(u=An.env.DEBUG),u}function o(){try{return localStorage}catch{}}t.exports=Hs(e);let{formatters:a}=t.exports;a.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}),xu=ie.colors,K=ie,Au=ie.destroy,Su=ie.formatArgs,Ru=ie.load,Mu=ie.log,ku=ie.save,Tu=ie.storage,Iu=ie.useColors;var Ot=typeof Deno<"u";var qr="DEBUG";if(Ot){K.useColors=()=>!Deno.noColor;let t={name:"env",variable:qr},e=await Deno.permissions.query(t),n;e.state==="granted"&&(n=Deno.env.get(qr)),n?K.enable(n):K.disable()}var Nr=t=>ReadableStream.from(t),$r=t=>({});var se=class extends Error{constructor(n,r,i,s){super(`${n} (${r.error_code}: ${r.description})`);this.method=i;this.payload=s;this.name="GrammyError",this.error_code=r.error_code,this.description=r.description,this.parameters=r.parameters??{}}ok=!1;error_code;description;parameters};function Hr(t,e,n){return new se(`Call to '${e}' failed!`,t,e,n)}var Ne=class extends Error{constructor(n,r){super(n);this.error=r;this.name="HttpError"}};function Gs(t){return typeof t=="object"&&t!==null&&"status"in t&&"statusText"in t}function Gr(t,e){return n=>{let r=`Network request for '${t}' failed!`;throw Gs(n)&&(r+=` (${n.status}: ${n.statusText})`),e&&n instanceof Error&&(r+=` ${n.message}`),new Ne(r,n)}}var Ws=(()=>{let{Deno:t}=globalThis;if(typeof t?.build?.os=="string")return t.build.os;let{navigator:e}=globalThis;return e?.appVersion?.includes?.("Win")?"windows":"linux"})(),Wr=Ws==="windows";function Vr(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function Lt(t,e){if(e.length>=t.length)return t;let n=t.length-e.length;for(let r=e.length-1;r>=0;--r)if(t.charCodeAt(n+r)!==e.charCodeAt(r))return t;return t.slice(0,-e.length)}function jt(t,e,n=0){let r=!1,i=t.length;for(let s=t.length-1;s>=n;--s)if(e(t.charCodeAt(s))){if(r){n=s+1;break}}else r||(r=!0,i=s+1);return t.slice(n,i)}function Qt(t,e){if(Vr(t),t.length===0)return t;if(typeof e!="string")throw new TypeError(`Suffix must be a string. Received ${JSON.stringify(e)}`)}function Ut(t,e){if(t.length<=1)return t;let n=t.length;for(let r=t.length-1;r>0&&e(t.charCodeAt(r));r--)n=r;return t.slice(0,n)}function Rn(t){return t===47}function zr(t,e=""){Qt(t,e);let n=jt(t,Rn),r=Ut(n,Rn);return e?Lt(r,e):r}function Mn(t){return t===47||t===92}function Yr(t){return t>=97&&t<=122||t>=65&&t<=90}function Jr(t,e=""){Qt(t,e);let n=0;if(t.length>=2){let s=t.charCodeAt(0);Yr(s)&&t.charCodeAt(1)===58&&(n=2)}let r=jt(t,Mn,n),i=Ut(r,Mn);return e?Lt(i,e):i}function st(t,e=""){return Wr?Jr(t,e):zr(t,e)}async function*kn(t,e){let n=e?.bufSize??32768,r=new Uint8Array(n);for(;;){let i=await t.read(r);if(i===null)break;yield r.slice(0,i)}}var to=K("grammy:warn"),ke=class t{consumed=!1;fileData;filename;constructor(e,n){this.fileData=e,n??=this.guessFilename(e),this.filename=n,typeof e=="string"&&(e.startsWith("http:")||e.startsWith("https:"))&&to(`InputFile received the local file path '${e}' that looks like a URL. Is this a mistake?`)}guessFilename(e){if(typeof e=="string")return st(e);if("url"in e)return st(e.url);if(e instanceof URL){if(e.pathname!=="/"){let n=st(e.pathname);if(n)return n}return st(e.hostname)}}async toRaw(){if(this.consumed)throw new Error("Cannot reuse InputFile data source!");let e=this.fileData;if(typeof e=="string"){if(!Ot)throw new Error("Reading files by path requires a Deno environment");let n=await Deno.open(e);return kn(n)}if(e instanceof Blob)return e.stream();if(no(e))return kn(e);if(e instanceof Response){if(e.body===null)throw new Error("No response body!");return e.body}return e instanceof URL?Xr(e):"url"in e?Xr(e.url):e instanceof Uint8Array?e:typeof e=="function"?new t(await e()).toRaw():(this.consumed=!0,e)}};async function*Xr(t){let{body:e}=await fetch(t);if(e===null)throw new Error(`Download failed, no response body from '${t}'`);yield*e}function no(t){return Ot&&t instanceof Deno.FsFile}function Kt(t){return t instanceof ke||typeof t=="object"&&t!==null&&Object.values(t).some(e=>Array.isArray(e)?e.some(Kt):e instanceof ke||Kt(e))}function Zr(t){return JSON.stringify(t,(e,n)=>n??void 0)}function In(t){return{method:"POST",headers:{"content-type":"application/json",connection:"keep-alive"},body:Zr(t)}}async function*ro(t,e){try{yield*t}catch(n){e(n)}}function ei(t,e){let n=io(),r=so(t,n),i=ro(r,e),s=Nr(i);return{method:"POST",headers:{"content-type":`multipart/form-data; boundary=${n}`,connection:"keep-alive"},body:s}}function io(){return"----------"+ti(32)}function ti(t=16){return Array.from(Array(t)).map(()=>Math.random().toString(36)[2]||0).join("")}var ot=new TextEncoder;async function*so(t,e){let n=Tn(t);yield ot.encode(`--${e}\r
`);let r=ot.encode(`\r
--${e}\r
`),i=!0;for(let[s,o]of Object.entries(t))o!=null&&(i||(yield r),yield oo(s,typeof o=="object"?Zr(o):o),i=!1);for(let{id:s,origin:o,file:a}of n)i||(yield r),yield*ao(s,o,a),i=!1;yield ot.encode(`\r
--${e}--\r
`)}function Tn(t){return typeof t!="object"||t===null?[]:Object.entries(t).flatMap(([e,n])=>{if(Array.isArray(n))return n.flatMap(r=>Tn(r));if(n instanceof ke){let r=ti();Object.assign(t,{[e]:`attach://${r}`});let i=e==="media"&&"type"in t&&typeof t.type=="string"?t.type:e;return{id:r,origin:i,file:n}}else return Tn(n)})}function oo(t,e){return ot.encode(`content-disposition:form-data;name="${t}"\r
\r
${e}`)}async function*ao(t,e,n){let r=n.filename||`${e}.${uo(e)}`;if(r.includes("\r")||r.includes(`
`))throw new Error(`File paths cannot contain carriage-return (\\r) or newline (\\n) characters! Filename for property '${e}' was:
"""
${r}
"""`);yield ot.encode(`content-disposition:form-data;name="${t}";filename=${r}\r
content-type:application/octet-stream\r
\r
`);let i=await n.toRaw();i instanceof Uint8Array?yield i:yield*i}function uo(t){switch(t){case"certificate":return"pem";case"photo":case"thumbnail":return"jpg";case"voice":return"ogg";case"audio":return"mp3";case"animation":case"video":case"video_note":return"mp4";case"sticker":return"webp";default:return"dat"}}var lo=K("grammy:core");function co(t,e){return(n,r,i)=>e(t,n,r,i)}var En=class{constructor(e,n={},r={}){this.token=e;this.webhookReplyEnvelope=r;let i=n.apiRoot??"https://api.telegram.org",s=n.environment??"prod";if(this.options={apiRoot:i,environment:s,buildUrl:n.buildUrl??ho,timeoutSeconds:n.timeoutSeconds??500,baseFetchConfig:{...$r(i),...n.baseFetchConfig},canUseWebhookReply:n.canUseWebhookReply??(()=>!1),sensitiveLogs:n.sensitiveLogs??!1},this.options.apiRoot.endsWith("/"))throw new Error(`Remove the trailing '/' from the 'apiRoot' option (use '${this.options.apiRoot.substring(0,this.options.apiRoot.length-1)}' instead of '${this.options.apiRoot}')`)}options;hasUsedWebhookReply=!1;installedTransformers=[];call=async(e,n,r)=>{let i=n??{};lo(`Calling ${e}`),r!==void 0&&fo(e,i,r);let s=this.options,o=Kt(i);if(this.webhookReplyEnvelope.send!==void 0&&!this.hasUsedWebhookReply&&!o&&s.canUseWebhookReply(e)){this.hasUsedWebhookReply=!0;let p=In({...i,method:e});return await this.webhookReplyEnvelope.send(p.body),{ok:!0,result:!0}}let a=yo(r),u=mo(a,s.timeoutSeconds,e),d=go(a),h=s.buildUrl(s.apiRoot,this.token,e,s.environment),c=o?ei(i,p=>d.catch(p)):In(i),l=a.signal,f={...s.baseFetchConfig,signal:l,...c},m=[fetch(h instanceof URL?h.href:h,f).catch(Gr(e,s.sensitiveLogs)),d.promise,u.promise];try{return await(await Promise.race(m)).json()}finally{u.handle!==void 0&&clearTimeout(u.handle)}};use(...e){return this.call=e.reduce(co,this.call),this.installedTransformers.push(...e),this}async callApi(e,n,r){let i=await this.call(e,n,r);if(i.ok)return i.result;throw Hr(i,e,n)}};function ni(t,e,n){let r=new En(t,e,n),i={get(u,d){return d==="toJSON"?"__internal":r.callApi.bind(r,d)},...po},s=new Proxy({},i),o=r.installedTransformers,a={raw:s,installedTransformers:o,use:(...u)=>(r.use(...u),a)};return a}var ho=(t,e,n,r)=>`${t}/bot${e}/${r==="test"?"test/":""}${n}`,po={set(){return!1},defineProperty(){return!1},deleteProperty(){return!1},ownKeys(){return[]}};function mo(t,e,n){let r;return{promise:new Promise((s,o)=>{r=setTimeout(()=>{let a=`Request to '${n}' timed out after ${e} seconds`;o(new Error(a)),t.abort()},1e3*e)}),handle:r}}function go(t){let e=r=>{throw r};return{promise:new Promise((r,i)=>{e=s=>{i(s),t.abort()}}),catch:e}}function yo(t){let e=new AbortController;if(t===void 0)return e;let n=t;function r(){e.abort(),n.removeEventListener("abort",r)}return n.aborted?r():n.addEventListener("abort",r),{abort:r,signal:e.signal}}function fo(t,e,n){if(typeof n?.addEventListener=="function")return;let r=JSON.stringify(e);r.length>20&&(r=r.substring(0,16)+" ...");let i=JSON.stringify(n);throw i.length>20&&(i=i.substring(0,16)+" ..."),new Error(`Incorrect abort signal instance found! You passed two payloads to '${t}' but you should merge the second one containing '${i}' into the first one containing '${r}'! If you are using context shortcuts, you may want to use a method on 'ctx.api' instead.

If you want to prevent such mistakes in the future, consider using TypeScript. https://www.typescriptlang.org/`)}var $e=class{raw;config;constructor(e,n,r){let{raw:i,use:s,installedTransformers:o}=ni(e,n,r);this.raw=i,this.config={use:s,installedTransformers:()=>[...o]}}getUpdates(e,n){return this.raw.getUpdates({...e},n)}setWebhook(e,n,r){return this.raw.setWebhook({url:e,...n},r)}deleteWebhook(e,n){return this.raw.deleteWebhook({...e},n)}getWebhookInfo(e){return this.raw.getWebhookInfo(e)}getMe(e){return this.raw.getMe(e)}logOut(e){return this.raw.logOut(e)}close(e){return this.raw.close(e)}sendMessage(e,n,r,i){return this.raw.sendMessage({chat_id:e,text:n,...r},i)}forwardMessage(e,n,r,i,s){return this.raw.forwardMessage({chat_id:e,from_chat_id:n,message_id:r,...i},s)}forwardMessages(e,n,r,i,s){return this.raw.forwardMessages({chat_id:e,from_chat_id:n,message_ids:r,...i},s)}copyMessage(e,n,r,i,s){return this.raw.copyMessage({chat_id:e,from_chat_id:n,message_id:r,...i},s)}copyMessages(e,n,r,i,s){return this.raw.copyMessages({chat_id:e,from_chat_id:n,message_ids:r,...i},s)}sendPhoto(e,n,r,i){return this.raw.sendPhoto({chat_id:e,photo:n,...r},i)}sendAudio(e,n,r,i){return this.raw.sendAudio({chat_id:e,audio:n,...r},i)}sendDocument(e,n,r,i){return this.raw.sendDocument({chat_id:e,document:n,...r},i)}sendVideo(e,n,r,i){return this.raw.sendVideo({chat_id:e,video:n,...r},i)}sendAnimation(e,n,r,i){return this.raw.sendAnimation({chat_id:e,animation:n,...r},i)}sendVoice(e,n,r,i){return this.raw.sendVoice({chat_id:e,voice:n,...r},i)}sendVideoNote(e,n,r,i){return this.raw.sendVideoNote({chat_id:e,video_note:n,...r},i)}sendMediaGroup(e,n,r,i){return this.raw.sendMediaGroup({chat_id:e,media:n,...r},i)}sendLocation(e,n,r,i,s){return this.raw.sendLocation({chat_id:e,latitude:n,longitude:r,...i},s)}editMessageLiveLocation(e,n,r,i,s,o){return this.raw.editMessageLiveLocation({chat_id:e,message_id:n,latitude:r,longitude:i,...s},o)}editMessageLiveLocationInline(e,n,r,i,s){return this.raw.editMessageLiveLocation({inline_message_id:e,latitude:n,longitude:r,...i},s)}stopMessageLiveLocation(e,n,r,i){return this.raw.stopMessageLiveLocation({chat_id:e,message_id:n,...r},i)}stopMessageLiveLocationInline(e,n,r){return this.raw.stopMessageLiveLocation({inline_message_id:e,...n},r)}sendVenue(e,n,r,i,s,o,a){return this.raw.sendVenue({chat_id:e,latitude:n,longitude:r,title:i,address:s,...o},a)}sendContact(e,n,r,i,s){return this.raw.sendContact({chat_id:e,phone_number:n,first_name:r,...i},s)}sendPoll(e,n,r,i,s){return this.raw.sendPoll({chat_id:e,question:n,options:r,...i},s)}sendDice(e,n,r,i){return this.raw.sendDice({chat_id:e,emoji:n,...r},i)}setMessageReaction(e,n,r,i,s){return this.raw.setMessageReaction({chat_id:e,message_id:n,reaction:r,...i},s)}sendChatAction(e,n,r,i){return this.raw.sendChatAction({chat_id:e,action:n,...r},i)}getUserProfilePhotos(e,n,r){return this.raw.getUserProfilePhotos({user_id:e,...n},r)}getUserChatBoosts(e,n,r){return this.raw.getUserChatBoosts({chat_id:e,user_id:n},r)}getFile(e,n){return this.raw.getFile({file_id:e},n)}kickChatMember(...e){return this.banChatMember(...e)}banChatMember(e,n,r,i){return this.raw.banChatMember({chat_id:e,user_id:n,...r},i)}unbanChatMember(e,n,r,i){return this.raw.unbanChatMember({chat_id:e,user_id:n,...r},i)}restrictChatMember(e,n,r,i,s){return this.raw.restrictChatMember({chat_id:e,user_id:n,permissions:r,...i},s)}promoteChatMember(e,n,r,i){return this.raw.promoteChatMember({chat_id:e,user_id:n,...r},i)}setChatAdministratorCustomTitle(e,n,r,i){return this.raw.setChatAdministratorCustomTitle({chat_id:e,user_id:n,custom_title:r},i)}banChatSenderChat(e,n,r){return this.raw.banChatSenderChat({chat_id:e,sender_chat_id:n},r)}unbanChatSenderChat(e,n,r){return this.raw.unbanChatSenderChat({chat_id:e,sender_chat_id:n},r)}setChatPermissions(e,n,r){return this.raw.setChatPermissions({chat_id:e,permissions:n},r)}exportChatInviteLink(e,n){return this.raw.exportChatInviteLink({chat_id:e},n)}createChatInviteLink(e,n,r){return this.raw.createChatInviteLink({chat_id:e,...n},r)}editChatInviteLink(e,n,r,i){return this.raw.editChatInviteLink({chat_id:e,invite_link:n,...r},i)}revokeChatInviteLink(e,n,r){return this.raw.revokeChatInviteLink({chat_id:e,invite_link:n},r)}approveChatJoinRequest(e,n,r){return this.raw.approveChatJoinRequest({chat_id:e,user_id:n},r)}declineChatJoinRequest(e,n,r){return this.raw.declineChatJoinRequest({chat_id:e,user_id:n},r)}setChatPhoto(e,n,r){return this.raw.setChatPhoto({chat_id:e,photo:n},r)}deleteChatPhoto(e,n){return this.raw.deleteChatPhoto({chat_id:e},n)}setChatTitle(e,n,r){return this.raw.setChatTitle({chat_id:e,title:n},r)}setChatDescription(e,n,r){return this.raw.setChatDescription({chat_id:e,description:n},r)}pinChatMessage(e,n,r,i){return this.raw.pinChatMessage({chat_id:e,message_id:n,...r},i)}unpinChatMessage(e,n,r){return this.raw.unpinChatMessage({chat_id:e,message_id:n},r)}unpinAllChatMessages(e,n){return this.raw.unpinAllChatMessages({chat_id:e},n)}leaveChat(e,n){return this.raw.leaveChat({chat_id:e},n)}getChat(e,n){return this.raw.getChat({chat_id:e},n)}getChatAdministrators(e,n){return this.raw.getChatAdministrators({chat_id:e},n)}getChatMembersCount(...e){return this.getChatMemberCount(...e)}getChatMemberCount(e,n){return this.raw.getChatMemberCount({chat_id:e},n)}getChatMember(e,n,r){return this.raw.getChatMember({chat_id:e,user_id:n},r)}setChatStickerSet(e,n,r){return this.raw.setChatStickerSet({chat_id:e,sticker_set_name:n},r)}deleteChatStickerSet(e,n){return this.raw.deleteChatStickerSet({chat_id:e},n)}getForumTopicIconStickers(e){return this.raw.getForumTopicIconStickers(e)}createForumTopic(e,n,r,i){return this.raw.createForumTopic({chat_id:e,name:n,...r},i)}editForumTopic(e,n,r,i){return this.raw.editForumTopic({chat_id:e,message_thread_id:n,...r},i)}closeForumTopic(e,n,r){return this.raw.closeForumTopic({chat_id:e,message_thread_id:n},r)}reopenForumTopic(e,n,r){return this.raw.reopenForumTopic({chat_id:e,message_thread_id:n},r)}deleteForumTopic(e,n,r){return this.raw.deleteForumTopic({chat_id:e,message_thread_id:n},r)}unpinAllForumTopicMessages(e,n,r){return this.raw.unpinAllForumTopicMessages({chat_id:e,message_thread_id:n},r)}editGeneralForumTopic(e,n,r){return this.raw.editGeneralForumTopic({chat_id:e,name:n},r)}closeGeneralForumTopic(e,n){return this.raw.closeGeneralForumTopic({chat_id:e},n)}reopenGeneralForumTopic(e,n){return this.raw.reopenGeneralForumTopic({chat_id:e},n)}hideGeneralForumTopic(e,n){return this.raw.hideGeneralForumTopic({chat_id:e},n)}unhideGeneralForumTopic(e,n){return this.raw.unhideGeneralForumTopic({chat_id:e},n)}unpinAllGeneralForumTopicMessages(e,n){return this.raw.unpinAllGeneralForumTopicMessages({chat_id:e},n)}answerCallbackQuery(e,n,r){return this.raw.answerCallbackQuery({callback_query_id:e,...n},r)}setMyName(e,n,r){return this.raw.setMyName({name:e,...n},r)}getMyName(e,n){return this.raw.getMyName(e??{},n)}setMyCommands(e,n,r){return this.raw.setMyCommands({commands:e,...n},r)}deleteMyCommands(e,n){return this.raw.deleteMyCommands({...e},n)}getMyCommands(e,n){return this.raw.getMyCommands({...e},n)}setMyDescription(e,n,r){return this.raw.setMyDescription({description:e,...n},r)}getMyDescription(e,n){return this.raw.getMyDescription({...e},n)}setMyShortDescription(e,n,r){return this.raw.setMyShortDescription({short_description:e,...n},r)}getMyShortDescription(e,n){return this.raw.getMyShortDescription({...e},n)}setChatMenuButton(e,n){return this.raw.setChatMenuButton({...e},n)}getChatMenuButton(e,n){return this.raw.getChatMenuButton({...e},n)}setMyDefaultAdministratorRights(e,n){return this.raw.setMyDefaultAdministratorRights({...e},n)}getMyDefaultAdministratorRights(e,n){return this.raw.getMyDefaultAdministratorRights({...e},n)}editMessageText(e,n,r,i,s){return this.raw.editMessageText({chat_id:e,message_id:n,text:r,...i},s)}editMessageTextInline(e,n,r,i){return this.raw.editMessageText({inline_message_id:e,text:n,...r},i)}editMessageCaption(e,n,r,i){return this.raw.editMessageCaption({chat_id:e,message_id:n,...r},i)}editMessageCaptionInline(e,n,r){return this.raw.editMessageCaption({inline_message_id:e,...n},r)}editMessageMedia(e,n,r,i,s){return this.raw.editMessageMedia({chat_id:e,message_id:n,media:r,...i},s)}editMessageMediaInline(e,n,r,i){return this.raw.editMessageMedia({inline_message_id:e,media:n,...r},i)}editMessageReplyMarkup(e,n,r,i){return this.raw.editMessageReplyMarkup({chat_id:e,message_id:n,...r},i)}editMessageReplyMarkupInline(e,n,r){return this.raw.editMessageReplyMarkup({inline_message_id:e,...n},r)}stopPoll(e,n,r,i){return this.raw.stopPoll({chat_id:e,message_id:n,...r},i)}deleteMessage(e,n,r){return this.raw.deleteMessage({chat_id:e,message_id:n},r)}deleteMessages(e,n,r){return this.raw.deleteMessages({chat_id:e,message_ids:n},r)}sendSticker(e,n,r,i){return this.raw.sendSticker({chat_id:e,sticker:n,...r},i)}getStickerSet(e,n){return this.raw.getStickerSet({name:e},n)}getCustomEmojiStickers(e,n){return this.raw.getCustomEmojiStickers({custom_emoji_ids:e},n)}uploadStickerFile(e,n,r,i){return this.raw.uploadStickerFile({user_id:e,sticker_format:n,sticker:r},i)}createNewStickerSet(e,n,r,i,s,o,a){return this.raw.createNewStickerSet({user_id:e,name:n,title:r,stickers:i,sticker_format:s,...o},a)}addStickerToSet(e,n,r,i){return this.raw.addStickerToSet({user_id:e,name:n,sticker:r},i)}setStickerPositionInSet(e,n,r){return this.raw.setStickerPositionInSet({sticker:e,position:n},r)}deleteStickerFromSet(e,n){return this.raw.deleteStickerFromSet({sticker:e},n)}setStickerEmojiList(e,n,r){return this.raw.setStickerEmojiList({sticker:e,emoji_list:n},r)}setStickerKeywords(e,n,r){return this.raw.setStickerKeywords({sticker:e,keywords:n},r)}setStickerMaskPosition(e,n,r){return this.raw.setStickerMaskPosition({sticker:e,mask_position:n},r)}setStickerSetTitle(e,n,r){return this.raw.setStickerSetTitle({name:e,title:n},r)}deleteStickerSet(e,n){return this.raw.deleteStickerSet({name:e},n)}setStickerSetThumbnail(e,n,r,i){return this.raw.setStickerSetThumbnail({name:e,user_id:n,thumbnail:r},i)}setCustomEmojiStickerSetThumbnail(e,n,r){return this.raw.setCustomEmojiStickerSetThumbnail({name:e,custom_emoji_id:n},r)}answerInlineQuery(e,n,r,i){return this.raw.answerInlineQuery({inline_query_id:e,results:n,...r},i)}answerWebAppQuery(e,n,r){return this.raw.answerWebAppQuery({web_app_query_id:e,result:n},r)}sendInvoice(e,n,r,i,s,o,a,u,d){return this.raw.sendInvoice({chat_id:e,title:n,description:r,payload:i,provider_token:s,currency:o,prices:a,...u},d)}createInvoiceLink(e,n,r,i,s,o,a,u){return this.raw.createInvoiceLink({title:e,description:n,payload:r,provider_token:i,currency:s,prices:o,...a},u)}answerShippingQuery(e,n,r,i){return this.raw.answerShippingQuery({shipping_query_id:e,ok:n,...r},i)}answerPreCheckoutQuery(e,n,r,i){return this.raw.answerPreCheckoutQuery({pre_checkout_query_id:e,ok:n,...r},i)}setPassportDataErrors(e,n,r){return this.raw.setPassportDataErrors({user_id:e,errors:n},r)}sendGame(e,n,r,i){return this.raw.sendGame({chat_id:e,game_short_name:n,...r},i)}setGameScore(e,n,r,i,s,o){return this.raw.setGameScore({chat_id:e,message_id:n,user_id:r,score:i,...s},o)}setGameScoreInline(e,n,r,i,s){return this.raw.setGameScore({inline_message_id:e,user_id:n,score:r,...i},s)}getGameHighScores(e,n,r,i){return this.raw.getGameHighScores({chat_id:e,message_id:n,user_id:r},i)}getGameHighScoresInline(e,n,r){return this.raw.getGameHighScores({inline_message_id:e,user_id:n},r)}};var ee=K("grammy:bot"),bo=K("grammy:warn"),fe=K("grammy:error"),Dt=["message","edited_message","channel_post","edited_channel_post","inline_query","chosen_inline_result","callback_query","shipping_query","pre_checkout_query","poll","poll_answer","my_chat_member","chat_join_request","chat_boost","removed_chat_boost"];var at=class extends it{constructor(n,r){super();this.token=n;if(!n)throw new Error("Empty token!");this.me=r?.botInfo,this.clientConfig=r?.client,this.ContextConstructor=r?.ContextConstructor??q,this.api=new $e(n,this.clientConfig)}pollingRunning=!1;pollingAbortController;lastTriedUpdateId=0;api;me;mePromise;clientConfig;ContextConstructor;observedUpdateTypes=new Set;errorHandler=async n=>{throw console.error("Error in middleware while handling update",n.ctx?.update?.update_id,n.error),console.error("No error handler was set!"),console.error("Set your own error handler with `bot.catch = ...`"),this.pollingRunning&&(console.error("Stopping bot"),await this.stop()),n};set botInfo(n){this.me=n}get botInfo(){if(this.me===void 0)throw new Error("Bot information unavailable! Make sure to call `await bot.init()` before accessing `bot.botInfo`!");return this.me}on(n,...r){for(let[i]of _n(n).flatMap(wn))this.observedUpdateTypes.add(i);return super.on(n,...r)}reaction(n,...r){return this.observedUpdateTypes.add("message_reaction"),super.reaction(n,...r)}isInited(){return this.me!==void 0}async init(n){if(!this.isInited()){ee("Initializing bot"),this.mePromise??=ri(()=>this.api.getMe(n),n);let r;try{r=await this.mePromise}finally{this.mePromise=void 0}this.me===void 0?this.me=r:ee("Bot info was set by now, will not overwrite")}ee(`I am ${this.me.username}!`)}async handleUpdates(n){for(let r of n){this.lastTriedUpdateId=r.update_id;try{await this.handleUpdate(r)}catch(i){if(i instanceof Ae)await this.errorHandler(i);else throw console.error("FATAL: grammY unable to handle:",i),i}}}async handleUpdate(n,r){if(this.me===void 0)throw new Error("Bot not initialized! Either call `await bot.init()`, or directly set the `botInfo` option in the `Bot` constructor to specify a known bot info object.");ee(`Processing update ${n.update_id}`);let i=new $e(this.token,this.clientConfig,r),s=this.api.config.installedTransformers();s.length>0&&i.config.use(...s);let o=new this.ContextConstructor(n,i,this.me);try{await xn(this.middleware(),o)}catch(a){throw fe(`Error in middleware for update ${n.update_id}`),new Ae(a,o)}}async start(n){let r=[];if(this.isInited()||r.push(this.init(this.pollingAbortController?.signal)),this.pollingRunning){await Promise.all(r),ee("Simple long polling already running!");return}else this.pollingRunning=!0,this.pollingAbortController=new AbortController;r.push(ri(async()=>{await this.api.deleteWebhook({drop_pending_updates:n?.drop_pending_updates},this.pollingAbortController?.signal)},this.pollingAbortController?.signal)),await Promise.all(r),await n?.onStart?.(this.botInfo),this.pollingRunning&&(Co(this.observedUpdateTypes,n?.allowed_updates),this.use=_o,ee("Starting simple long polling"),await this.loop(n),ee("Middleware is done running"))}async stop(){if(this.pollingRunning){ee("Stopping bot, saving update offset"),this.pollingRunning=!1,this.pollingAbortController?.abort();let n=this.lastTriedUpdateId+1;await this.api.getUpdates({offset:n,limit:1}).finally(()=>this.pollingAbortController=void 0)}else ee("Bot is not running!")}catch(n){this.errorHandler=n}async loop(n){let r=n?.limit,i=n?.timeout??30,s=n?.allowed_updates??[];for(;this.pollingRunning;){let o=await this.fetchUpdates({limit:r,timeout:i,allowed_updates:s});if(o===void 0)break;await this.handleUpdates(o),s=void 0}}async fetchUpdates({limit:n,timeout:r,allowed_updates:i}){let s=this.lastTriedUpdateId+1,o;do try{o=await this.api.getUpdates({offset:s,limit:n,timeout:r,allowed_updates:i},this.pollingAbortController?.signal)}catch(a){await this.handlePollingError(a)}while(o===void 0&&this.pollingRunning);return o}async handlePollingError(n){if(!this.pollingRunning){ee("Pending getUpdates request cancelled");return}let r=3;if(n instanceof se){if(fe(n.message),n.error_code===401)throw fe("Make sure you are using the bot token you obtained from @BotFather (https://t.me/BotFather)."),n;if(n.error_code===409)throw fe("Consider revoking the bot token if you believe that no other instance is running."),n;n.error_code===429&&(fe("Bot API server is closing."),r=n.parameters.retry_after??r)}else fe(n);fe(`Call to getUpdates failed, retrying in ${r} seconds ...`),await Fn(r)}};async function ri(t,e){let r=50;async function i(o){let a=!1,u="rethrow";if(o instanceof Ne)a=!0,u="retry";else if(o instanceof se){if(o.error_code>=500)a=!0,u="retry";else if(o.error_code===429){let d=o.parameters.retry_after;typeof d=="number"?(await Fn(d,e),r=50):a=!0,u="retry"}}if(a){r!==50&&await Fn(r,e);let d=20*60*1e3;r=Math.min(d,2*r)}return u}let s={ok:!1};for(;!s.ok;)try{s={ok:!0,value:await t()}}catch(o){switch(fe(o),await i(o)){case"retry":continue;case"rethrow":throw o}}return s.value}async function Fn(t,e){let n,r;function i(){r?.(new Error("Aborted delay")),n!==void 0&&clearTimeout(n)}try{await new Promise((s,o)=>{if(r=o,e?.aborted){i();return}e?.addEventListener("abort",i),n=setTimeout(s,1e3*t)})}finally{e?.removeEventListener("abort",i)}}function Co(t,e=Dt){let n=Array.from(t).filter(r=>!e.includes(r));n.length>0&&bo(`You registered listeners for the following update types, but you did not specify them in \`allowed_updates\` so they may not be received: ${n.map(r=>`'${r}'`).join(", ")}`)}function _o(){throw new Error(`It looks like you are registering more listeners on your bot from within other listeners! This means that every time your bot handles a message like this one, new listeners will be added. This list grows until your machine crashes, so grammY throws this error to tell you that you should probably do things a bit differently. If you're unsure how to resolve this problem, you can ask in the group chat: https://telegram.me/grammyjs

On the other hand, if you actually know what you're doing and you do need to install further middleware while your bot is running, consider installing a composer instance on your bot, and in turn augment the composer after the fact. This way, you can circumvent this protection against memory leaks.`)}var wo=[...Dt,"chat_member","message_reaction","message_reaction_count"],vo={can_send_messages:!0,can_send_audios:!0,can_send_documents:!0,can_send_photos:!0,can_send_videos:!0,can_send_video_notes:!0,can_send_voice_notes:!0,can_send_polls:!0,can_send_other_messages:!0,can_add_web_page_previews:!0,can_change_info:!0,can_invite_users:!0,can_pin_messages:!0,can_manage_topics:!0},xo={DEFAULT_UPDATE_TYPES:Dt,ALL_UPDATE_TYPES:wo,ALL_CHAT_PERMISSIONS:vo};Object.freeze(xo);var zl=K("grammy:session");var N="X-Telegram-Bot-Api-Secret-Token",Pn=N.toLowerCase(),oe="secret token is wrong",ut=()=>new Response(null,{status:200}),lt=t=>new Response(t,{status:200,headers:{"Content-Type":"application/json"}}),dt=()=>new Response('"unauthorized"',{status:401,statusText:oe}),Ao=(t,e,n)=>({update:JSON.parse(t.body),header:t.headers[N],end:()=>n(null,{statusCode:200}),respond:r=>n(null,{statusCode:200,headers:{"Content-Type":"application/json"},body:r}),unauthorized:()=>n(null,{statusCode:401})}),So=(t,e)=>{let n;return{update:JSON.parse(t.body),header:t.headers[N],end:()=>n({statusCode:200}),respond:r=>n({statusCode:200,headers:{"Content-Type":"application/json"},body:r}),unauthorized:()=>n({statusCode:401}),handlerReturn:new Promise(r=>{n=r})}},Ro=(t,e)=>({update:Promise.resolve(e.body),header:t.res.headers[N],end:()=>t.res={status:200,body:""},respond:n=>{t.res.set("Content-Type","application/json"),t.res.send(n)},unauthorized:()=>{t.res.send(401,oe)}}),Mo=t=>{let e;return t.respondWith(new Promise(n=>{e=n})),{update:t.request.json(),header:t.request.headers.get(N)||void 0,end:()=>{e(ut())},respond:n=>{e(lt(n))},unauthorized:()=>{e(dt())}}},ko=t=>{let e;return{update:t.json(),header:t.headers.get(N)||void 0,end:()=>{e(ut())},respond:n=>{e(lt(n))},unauthorized:()=>{e(dt())},handlerReturn:new Promise(n=>{e=n})}},To=(t,e)=>({update:Promise.resolve(t.body),header:t.header(N),end:()=>e.end(),respond:n=>{e.set("Content-Type","application/json"),e.send(n)},unauthorized:()=>{e.status(401).send(oe)}}),Io=(t,e)=>({update:Promise.resolve(t.body),header:t.headers[Pn],end:()=>e.status(200).send(),respond:n=>e.send(n),unauthorized:()=>e.code(401).send(oe)}),Eo=t=>{let e;return{update:t.req.json(),header:t.req.header(N),end:()=>{e(t.body())},respond:n=>{e(t.json(n))},unauthorized:()=>{t.status(401),t.statusText(oe),e(t.body())},handlerReturn:new Promise(n=>{e=n})}},ii=(t,e)=>{let n=t.headers[Pn];return{update:new Promise((r,i)=>{let s=[];t.on("data",o=>s.push(o)).once("end",()=>{let o=Buffer.concat(s).toString("utf-8");r(JSON.parse(o))}).once("error",i)}),header:Array.isArray(n)?n[0]:n,end:()=>e.end(),respond:r=>e.writeHead(200,{"Content-Type":"application/json"}).end(r),unauthorized:()=>e.writeHead(401).end(oe)}},Fo=t=>({update:Promise.resolve(t.request.body),header:t.get(N),end:()=>{t.body=""},respond:e=>{t.set("Content-Type","application/json"),t.response.body=e},unauthorized:()=>{t.status=401}}),Po=(t,e)=>({update:Promise.resolve(t.body),header:t.headers[Pn],end:()=>e.end(),respond:n=>e.status(200).json(n),unauthorized:()=>e.status(401).send(oe)}),Oo=t=>({update:t.body,header:t.headers.get(N)||void 0,end:()=>t.response.sendStatus(200),respond:e=>t.response.status(200).send(e),unauthorized:()=>t.response.status(401).send(oe)}),Lo=t=>({update:t.request.body({type:"json"}).value,header:t.request.headers.get(N)||void 0,end:()=>{t.response.status=200},respond:e=>{t.response.type="json",t.response.body=e},unauthorized:()=>{t.response.status=401}}),jo=t=>({update:t.request.json(),header:t.request.headers.get(N)||void 0,end:()=>t.respondWith(ut()),respond:e=>t.respondWith(lt(e)),unauthorized:()=>t.respondWith(dt())}),Qo=t=>{let e;return{update:t.json(),header:t.headers.get(N)||void 0,end:()=>{e&&e(ut())},respond:n=>{e&&e(lt(n))},unauthorized:()=>{e&&e(dt())},handlerReturn:new Promise(n=>{e=n})}},Uo=({request:t})=>{let e;return{update:Promise.resolve(t.json()),header:t.headers.get(N)||void 0,end:()=>{e&&e(ut())},respond:n=>{e&&e(lt(n))},unauthorized:()=>{e&&e(dt())},handlerReturn:new Promise(n=>{e=n})}},Ko=(t,e)=>({update:Promise.resolve(t.body.json()),header:t.headers.get(N),end:()=>e.end(),respond:n=>e.send(200,n),unauthorized:()=>e.send(401,oe)}),si={"aws-lambda":Ao,"aws-lambda-async":So,azure:Ro,cloudflare:Mo,"cloudflare-mod":ko,express:To,fastify:Io,hono:Eo,http:ii,https:ii,koa:Fo,"next-js":Po,nhttp:Oo,oak:Lo,serveHttp:jo,"std/http":Qo,sveltekit:Uo,worktop:Ko};var td=K("grammy:error"),Do=(t,e,n,r=()=>e('"unauthorized"'))=>({update:Promise.resolve(t),respond:e,header:n,unauthorized:r}),nd={...si,callback:Do};var Bo=globalThis||(typeof window<"u"?window:self),bi=(t,...e)=>setTimeout(t,0,...e),P=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Bo,j=Object.keys,B=Array.isArray;typeof Promise<"u"&&!P.Promise&&(P.Promise=Promise);function H(t,e){return typeof e!="object"||j(e).forEach(function(n){t[n]=e[n]}),t}var yt=Object.getPrototypeOf,qo={}.hasOwnProperty;function V(t,e){return qo.call(t,e)}function ze(t,e){typeof e=="function"&&(e=e(yt(t))),(typeof Reflect>"u"?j:Reflect.ownKeys)(e).forEach(n=>{he(t,n,e[n])})}var Ci=Object.defineProperty;function he(t,e,n,r){Ci(t,e,H(n&&V(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Ye(t){return{from:function(e){return t.prototype=Object.create(e.prototype),he(t.prototype,"constructor",t),{extend:ze.bind(null,t.prototype)}}}}var No=Object.getOwnPropertyDescriptor;function lr(t,e){let n=No(t,e),r;return n||(r=yt(t))&&lr(r,e)}var $o=[].slice;function ln(t,e,n){return $o.call(t,e,n)}function _i(t,e){return e(t)}function ct(t){if(!t)throw new Error("Assertion Failed")}function wi(t){P.setImmediate?bi(t):setTimeout(t,0)}function vi(t,e){return t.reduce((n,r,i)=>{var s=e(r,i);return s&&(n[s[0]]=s[1]),n},{})}function Ho(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function ce(t,e){if(typeof e=="string"&&V(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var s=ce(t,e[r]);n.push(s)}return n}var o=e.indexOf(".");if(o!==-1){var a=t[e.substr(0,o)];return a==null?void 0:ce(a,e.substr(o+1))}}function Z(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){ct(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)Z(t,e[r],n[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")n===void 0?B(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var u=t[o];(!u||!V(t,o))&&(u=t[o]={}),Z(u,a,n)}}else n===void 0?B(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function Go(t,e){typeof e=="string"?Z(t,e,void 0):"length"in e&&[].map.call(e,function(n){Z(t,n,void 0)})}function xi(t){var e={};for(var n in t)V(t,n)&&(e[n]=t[n]);return e}var Wo=[].concat;function Ai(t){return Wo.apply([],t)}var Si="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ai([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>P[t]),Vo=Si.map(t=>P[t]);vi(Si,t=>[t,!0]);var Ce=null;function xt(t){Ce=typeof WeakMap<"u"&&new WeakMap;let e=Dn(t);return Ce=null,e}function Dn(t){if(!t||typeof t!="object")return t;let e=Ce&&Ce.get(t);if(e)return e;if(B(t)){e=[],Ce&&Ce.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Dn(t[n]))}else if(Vo.indexOf(t.constructor)>=0)e=t;else{let s=yt(t);e=s===Object.prototype?{}:Object.create(s),Ce&&Ce.set(t,e);for(var i in t)V(t,i)&&(e[i]=Dn(t[i]))}return e}var{toString:zo}={};function Bn(t){return zo.call(t).slice(8,-1)}var qn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Yo=typeof qn=="symbol"?function(t){var e;return t!=null&&(e=t[qn])&&e.apply(t)}:function(){return null},We={};function le(t){var e,n,r,i;if(arguments.length===1){if(B(t))return t.slice();if(this===We&&typeof t=="string")return[t];if(i=Yo(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var dr=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1,ne=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ri(t,e){ne=t,Mi=e}var Mi=()=>!0,Jo=!new Error("").stack;function Le(){if(Jo)try{throw Le.arguments,new Error}catch(t){return t}return new Error}function Nn(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Mi).map(r=>`
`+r).join("")):""}var Xo=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],ki=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],cr=Xo.concat(ki),Zo={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Je(t,e){this._e=Le(),this.name=t,this.message=e}Ye(Je).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Nn(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Ti(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join(`
`)}function Zt(t,e,n,r){this._e=Le(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Ti(t,e)}Ye(Zt).from(Je);function pt(t,e){this._e=Le(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=Ti(t,e)}Ye(pt).from(Je);var hr=cr.reduce((t,e)=>(t[e]=e+"Error",t),{}),ea=Je,k=cr.reduce((t,e)=>{var n=e+"Error";function r(i,s){this._e=Le(),this.name=n,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Zo[e]||n,this.inner=null)}return Ye(r).from(ea),t[e]=r,t},{});k.Syntax=SyntaxError;k.Type=TypeError;k.Range=RangeError;var oi=ki.reduce((t,e)=>(t[e+"Error"]=k[e],t),{});function ta(t,e){if(!t||t instanceof Je||t instanceof TypeError||t instanceof SyntaxError||!t.name||!oi[t.name])return t;var n=new oi[t.name](e||t.message,t);return"stack"in t&&he(n,"stack",{get:function(){return this.inner.stack}}),n}var dn=cr.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=k[e]),t),{});dn.ModifyError=Zt;dn.DexieError=Je;dn.BulkError=pt;function F(){}function At(t){return t}function na(t,e){return t==null||t===At?e:function(n){return e(t(n))}}function Pe(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ra(t,e){return t===F?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Pe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Pe(i,this.onerror):i),s!==void 0?s:n}}function ia(t,e){return t===F?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Pe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Pe(r,this.onerror):r)}}function sa(t,e){return t===F?e:function(n){var r=t.apply(this,arguments);H(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Pe(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Pe(s,this.onerror):s),r===void 0?o===void 0?void 0:o:H(r,o)}}function oa(t,e){return t===F?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function pr(t,e){return t===F?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}var ft={},aa=100,ua=20,Ii=100,[$n,en,Hn]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,yt(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,yt(e),t]})(),Ei=en&&en.then,Gt=$n&&$n.constructor,mr=!!Hn,Gn=!1,la=Hn?()=>{Hn.then(Bt)}:P.setImmediate?bi.bind(null,Bt):P.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Bt(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Bt,0)},bt=function(t,e){ht.push([t,e]),tn&&(la(),tn=!1)},Wn=!0,tn=!0,Ee=[],Wt=[],Vn=null,zn=At,Ve={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:li,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{li(t[0],t[1])}catch{}})}},R=Ve,ht=[],Fe=0,Vt=[];function x(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=F,this._lib=!1;var e=this._PSD=R;if(ne&&(this._stackHolder=Le(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==ft)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Jn(this,this._value);return}this._state=null,this._value=null,++e.ref,Pi(this,t)}var Yn={get:function(){var t=R,e=nn;function n(r,i){var s=!t.global&&(t!==R||e!==nn);let o=s&&!pe();var a=new x((u,d)=>{gr(this,new Fi(sn(r,t,s,o),sn(i,t,s,o),u,d,t))});return ne&&ji(a,this),a}return n.prototype=ft,n},set:function(t){he(this,"then",t&&t.prototype===ft?Yn:{get:function(){return t},set:Yn.set})}};ze(x.prototype,{then:Yn,_then:function(t,e){gr(this,new Fi(null,null,t,e,R))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):zt(r)):this.then(null,r=>r&&r.name===e?n(r):zt(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),zt(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Gn=!0;var t=Li(this,[],ua),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Gn=!1}}},timeout:function(t,e){return t<1/0?new x((n,r)=>{var i=setTimeout(()=>r(new k.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&he(x.prototype,Symbol.toStringTag,"Dexie.Promise");Ve.env=Qi();function Fi(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}ze(x,{all:function(){var t=le.apply(null,arguments).map(rn);return new x(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((i,s)=>x.resolve(i).then(o=>{t[s]=o,--r||e(t)},n))})},resolve:t=>{if(t instanceof x)return t;if(t&&typeof t.then=="function")return new x((n,r)=>{t.then(n,r)});var e=new x(ft,!0,t);return ji(e,Vn),e},reject:zt,race:function(){var t=le.apply(null,arguments).map(rn);return new x((e,n)=>{t.map(r=>x.resolve(r).then(e,n))})},PSD:{get:()=>R,set:t=>R=t},totalEchoes:{get:()=>nn},newPSD:we,usePSD:Ze,scheduler:{get:()=>bt,set:t=>{bt=t}},rejectionMapper:{get:()=>zn,set:t=>{zn=t}},follow:(t,e)=>new x((n,r)=>we((i,s)=>{var o=R;o.unhandleds=[],o.onunhandled=s,o.finalize=Pe(function(){ca(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),t()},e,n,r))});Gt&&(Gt.allSettled&&he(x,"allSettled",function(){let t=le.apply(null,arguments).map(rn);return new x(e=>{t.length===0&&e([]);let n=t.length,r=new Array(n);t.forEach((i,s)=>x.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--n||e(r)))})}),Gt.any&&typeof AggregateError<"u"&&he(x,"any",function(){let t=le.apply(null,arguments).map(rn);return new x((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length,i=new Array(r);t.forEach((s,o)=>x.resolve(s).then(a=>e(a),a=>{i[o]=a,--r||n(new AggregateError(i))}))})}));function Pi(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&St();n&&typeof n.then=="function"?Pi(t,(i,s)=>{n instanceof x?n._then(i,s):n.then(i,s)}):(t._state=!0,t._value=n,Oi(t)),r&&Rt()}},Jn.bind(null,t))}catch(n){Jn(t,n)}}function Jn(t,e){if(Wt.push(e),t._state===null){var n=t._lib&&St();e=zn(e),t._state=!1,t._value=e,ne&&e!==null&&typeof e=="object"&&!e._promise&&Ho(()=>{var r=lr(e,"stack");e._promise=t,he(e,"stack",{get:()=>Gn?r&&(r.get?r.get.apply(e):r.value):t.stack})}),ha(t),Oi(t),n&&Rt()}}function Oi(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)gr(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),Fe===0&&(++Fe,bt(()=>{--Fe===0&&yr()},[]))}function gr(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Fe,bt(da,[n,t,e])}function da(t,e,n){try{Vn=e;var r,i=e._value;e._state?r=t(i):(Wt.length&&(Wt=[]),r=t(i),Wt.indexOf(i)===-1&&pa(e)),n.resolve(r)}catch(s){n.reject(s)}finally{Vn=null,--Fe===0&&yr(),--n.psd.ref||n.psd.finalize()}}function Li(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,r=Nn(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return ne&&(r=Nn(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&Li(t._prev,e,n)),e}function ji(t,e){var n=e?e._numPrev+1:0;n<aa&&(t._prev=e,t._numPrev=n)}function Bt(){St()&&Rt()}function St(){var t=Wn;return Wn=!1,tn=!1,t}function Rt(){var t,e,n;do for(;ht.length>0;)for(t=ht,ht=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(ht.length>0);Wn=!0,tn=!0}function yr(){var t=Ee;Ee=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Vt.slice(0),n=e.length;n;)e[--n]()}function ca(t){function e(){t(),Vt.splice(Vt.indexOf(e),1)}Vt.push(e),++Fe,bt(()=>{--Fe===0&&yr()},[])}function ha(t){Ee.some(e=>e._value===t._value)||Ee.push(t)}function pa(t){for(var e=Ee.length;e;)if(Ee[--e]._value===t._value){Ee.splice(e,1);return}}function zt(t){return new x(ft,!1,t)}function O(t,e){var n=R;return function(){var r=St(),i=R;try{return ve(n,!0),t.apply(this,arguments)}catch(s){e&&e(s)}finally{ve(i,!1),r&&Rt()}}}var D={awaits:0,echoes:0,id:0},ma=0,Yt=[],On=0,nn=0,ga=0;function we(t,e,n,r){var i=R,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++ga;var o=Ve.env;s.env=mr?{Promise:x,PromiseProp:{value:x,configurable:!0,writable:!0},all:x.all,race:x.race,allSettled:x.allSettled,any:x.any,resolve:x.resolve,reject:x.reject,nthen:ai(o.nthen,s),gthen:ai(o.gthen,s)}:{},e&&H(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Ze(s,t,n,r);return s.ref===0&&s.finalize(),a}function Xe(){return D.id||(D.id=++ma),++D.awaits,D.echoes+=Ii,D.id}function pe(){return D.awaits?(--D.awaits===0&&(D.id=0),D.echoes=D.awaits*Ii,!0):!1}(""+Ei).indexOf("[native code]")===-1&&(Xe=pe=F);function rn(t){return D.echoes&&t&&t.constructor===Gt?(Xe(),t.then(e=>(pe(),e),e=>(pe(),Q(e)))):t}function ya(t){++nn,(!D.echoes||--D.echoes===0)&&(D.echoes=D.id=0),Yt.push(R),ve(t,!0)}function fa(){var t=Yt[Yt.length-1];Yt.pop(),ve(t,!1)}function ve(t,e){var n=R;if((e?D.echoes&&(!On++||t!==R):On&&(!--On||t!==R))&&Ui(e?ya.bind(null,t):fa),t!==R&&(R=t,n===Ve&&(Ve.env=Qi()),mr)){var r=Ve.env.Promise,i=t.env;en.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(P,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Qi(){var t=P.Promise;return mr?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(P,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:en.then,gthen:t.prototype.then}:{}}function Ze(t,e,n,r,i){var s=R;try{return ve(t,!0),e(n,r,i)}finally{ve(s,!1)}}function Ui(t){Ei.call($n,t)}function sn(t,e,n,r){return typeof t!="function"?t:function(){var i=R;n&&Xe(),ve(e,!0);try{return t.apply(this,arguments)}finally{ve(i,!1),r&&Ui(pe)}}}function ai(t,e){return function(n,r){return t.call(this,sn(n,e),sn(r,e))}}var ui="unhandledrejection";function li(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(P.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(ui,!0,!0),H(r,i)):P.CustomEvent&&(r=new CustomEvent(ui,{detail:i}),H(r,i)),r&&P.dispatchEvent&&(dispatchEvent(r),!P.PromiseRejectionEvent&&P.onunhandledrejection))try{P.onunhandledrejection(r)}catch{}ne&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var Q=x.reject;function Xn(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!R.letThrough&&!t._vip){if(t._state.openComplete)return Q(new k.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return Q(new k.DatabaseClosed);t.open().catch(F)}return t._state.dbReadyPromise.then(()=>Xn(t,e,n,r))}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===hr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Xn(t,e,n,r))):Q(s)}return i._promise(e,(s,o)=>we(()=>(R.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}}var di="3.2.6",Ie="\uFFFF",Zn=-1/0,ae="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ki="String expected.",mt=[],cn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),ba=cn,Ca=cn,Di=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),hn="__dbnames",Ln="readonly",jn="readwrite";function Oe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Bi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function qt(t){return typeof t=="string"&&!/\./.test(t)?e=>(e[t]===void 0&&t in e&&(e=xt(e),delete e[t]),e):e=>e}var _a=class{_trans(t,e,n){let r=this._tx||R.trans,i=this.name;function s(a,u,d){if(!d.schema[i])throw new k.NotFound("Table "+i+" not part of transaction");return e(d.idbtrans,d)}let o=St();try{return r&&r.db===this.db?r===R.trans?r._promise(t,s,n):we(()=>r._promise(t,s,n),{trans:r,transless:R.transless||R}):Xn(this.db,t,[this.name],s)}finally{o&&Rt()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",n=>this.core.get({trans:n,key:t}).then(r=>this.hook.reading.fire(r))).then(e)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(B(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);let e=j(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);let n=this.schema.indexes.concat(this.schema.primKey).filter(u=>{if(u.compound&&e.every(d=>u.keyPath.indexOf(d)>=0)){for(let d=0;d<e.length;++d)if(e.indexOf(u.keyPath[d])===-1)return!1;return!0}return!1}).sort((u,d)=>u.keyPath.length-d.keyPath.length)[0];if(n&&this.db._maxKey!==Ie){let u=n.keyPath.slice(0,e.length);return this.where(u).equals(u.map(d=>t[d]))}!n&&ne&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${e.join("+")}]`);let{idxByName:r}=this.schema,i=this.db._deps.indexedDB;function s(u,d){try{return i.cmp(u,d)===0}catch{return!1}}let[o,a]=e.reduce(([u,d],h)=>{let c=r[h],l=t[h];return[u||c,u||!c?Oe(d,c&&c.multi?f=>{let y=ce(f,h);return B(y)&&y.some(m=>s(l,m))}:f=>s(l,ce(f,h))):d]},[null,null]);return o?this.where(o.name).equals(t[o.keyPath]).filter(a):n?this.filter(a):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,B(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;let e=n=>{if(!n)return n;let r=Object.create(t.prototype);for(var i in n)if(V(n,i))try{r[i]=n[i]}catch{}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){function t(e){H(this,e)}return this.mapToClass(t)}add(t,e){let{auto:n,keyPath:r}=this.schema.primKey,i=t;return r&&n&&(i=qt(r)(t)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"add",keys:e!=null?[e]:null,values:[i]})).then(s=>s.numFailures?x.reject(s.failures[0]):s.lastResult).then(s=>{if(r)try{Z(t,r,s)}catch{}return s})}update(t,e){if(typeof t=="object"&&!B(t)){let n=ce(t,this.schema.primKey.keyPath);if(n===void 0)return Q(new k.InvalidArgument("Given object does not contain its primary key"));try{typeof e!="function"?j(e).forEach(r=>{Z(t,r,e[r])}):e(t,{value:t,primKey:n})}catch{}return this.where(":id").equals(n).modify(e)}else return this.where(":id").equals(t).modify(e)}put(t,e){let{auto:n,keyPath:r}=this.schema.primKey,i=t;return r&&n&&(i=qt(r)(t)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"put",values:[i],keys:e!=null?[e]:null})).then(s=>s.numFailures?x.reject(s.failures[0]):s.lastResult).then(s=>{if(r)try{Z(t,r,s)}catch{}return s})}delete(t){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"delete",keys:[t]})).then(e=>e.numFailures?x.reject(e.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:Bi})).then(t=>t.numFailures?x.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",e=>this.core.getMany({keys:t,trans:e}).then(n=>n.map(r=>this.hook.reading.fire(r))))}bulkAdd(t,e,n){let r=Array.isArray(e)?e:void 0;n=n||(r?void 0:e);let i=n?n.allKeys:void 0;return this._trans("readwrite",s=>{let{auto:o,keyPath:a}=this.schema.primKey;if(a&&r)throw new k.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new k.InvalidArgument("Arguments objects and keys must have the same length");let u=t.length,d=a&&o?t.map(qt(a)):t;return this.core.mutate({trans:s,type:"add",keys:r,values:d,wantResults:i}).then(({numFailures:h,results:c,lastResult:l,failures:f})=>{let y=i?c:l;if(h===0)return y;throw new pt(`${this.name}.bulkAdd(): ${h} of ${u} operations failed`,f)})})}bulkPut(t,e,n){let r=Array.isArray(e)?e:void 0;n=n||(r?void 0:e);let i=n?n.allKeys:void 0;return this._trans("readwrite",s=>{let{auto:o,keyPath:a}=this.schema.primKey;if(a&&r)throw new k.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new k.InvalidArgument("Arguments objects and keys must have the same length");let u=t.length,d=a&&o?t.map(qt(a)):t;return this.core.mutate({trans:s,type:"put",keys:r,values:d,wantResults:i}).then(({numFailures:h,results:c,lastResult:l,failures:f})=>{let y=i?c:l;if(h===0)return y;throw new pt(`${this.name}.bulkPut(): ${h} of ${u} operations failed`,f)})})}bulkDelete(t){let e=t.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:t})).then(({numFailures:n,lastResult:r,failures:i})=>{if(n===0)return r;throw new pt(`${this.name}.bulkDelete(): ${n} of ${e} operations failed`,i)})}};function Mt(t){var e={},n=function(a,u){if(u){for(var d=arguments.length,h=new Array(d-1);--d;)h[d-1]=arguments[d];return e[a].subscribe.apply(null,h),t}else if(typeof a=="string")return e[a]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(a,u,d){if(typeof a=="object")return o(a);u||(u=oa),d||(d=F);var h={subscribers:[],fire:d,subscribe:function(c){h.subscribers.indexOf(c)===-1&&(h.subscribers.push(c),h.fire=u(h.fire,c))},unsubscribe:function(c){h.subscribers=h.subscribers.filter(function(l){return l!==c}),h.fire=h.subscribers.reduce(u,d)}};return e[a]=n[a]=h,h}function o(a){j(a).forEach(function(u){var d=a[u];if(B(d))s(u,a[u][0],a[u][1]);else if(d==="asap")var h=s(u,At,function(){for(var c=arguments.length,l=new Array(c);c--;)l[c]=arguments[c];h.subscribers.forEach(function(f){wi(function(){f.apply(null,l)})})});else throw new k.InvalidArgument("Invalid event config")})}}function kt(t,e){return Ye(e).from({prototype:t}),e}function wa(t){return kt(_a.prototype,function(e,n,r){this.db=t,this._tx=r,this.name=e,this.schema=n,this.hook=t._allTables[e]?t._allTables[e].hook:Mt(null,{creating:[ra,F],reading:[na,At],updating:[sa,F],deleting:[ia,F]})})}function He(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Qn(t,e){t.filter=Oe(t.filter,e)}function Un(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>Oe(r(),e()):e,t.justLimit=n&&!r}function va(t,e){t.isMatch=Oe(t.isMatch,e)}function Jt(t,e){if(t.isPrimKey)return e.primaryKey;let n=e.getIndexByKeyPath(t.index);if(!n)throw new k.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function ci(t,e,n){let r=Jt(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function Nt(t,e,n,r){let i=t.replayFilter?Oe(t.filter,t.replayFilter()):t.filter;if(t.or){let s={},o=(a,u,d)=>{if(!i||i(u,d,l=>u.stop(l),l=>u.fail(l))){var h=u.primaryKey,c=""+h;c==="[object ArrayBuffer]"&&(c=""+new Uint8Array(h)),V(s,c)||(s[c]=!0,e(a,u,d))}};return Promise.all([t.or._iterate(o,n),hi(ci(t,r,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}else return hi(ci(t,r,n),Oe(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function hi(t,e,n,r){var i=r?(o,a,u)=>n(r(o),a,u):n,s=O(i);return t.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,u=>a=u,u=>{o.stop(u),a=F},u=>{o.fail(u),a=F}))&&s(o.value,o,u=>a=u),a()})})}function $(t,e){try{let n=pi(t),r=pi(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Aa(mi(t),mi(e));case"Array":return xa(t,e)}}catch{}return NaN}function xa(t,e){let n=t.length,r=e.length,i=n<r?n:r;for(let s=0;s<i;++s){let o=$(t[s],e[s]);if(o!==0)return o}return n===r?0:n<r?-1:1}function Aa(t,e){let n=t.length,r=e.length,i=n<r?n:r;for(let s=0;s<i;++s)if(t[s]!==e[s])return t[s]<e[s]?-1:1;return n===r?0:n<r?-1:1}function pi(t){let e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";let n=Bn(t);return n==="ArrayBuffer"?"binary":n}function mi(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Sa=class{_read(t,e){var n=this._ctx;return n.error?n.table._trans(null,Q.bind(null,n.error)):n.table._trans("readonly",t).then(e)}_write(t){var e=this._ctx;return e.error?e.table._trans(null,Q.bind(null,e.error)):e.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var e=this._ctx;e.algorithm=Oe(e.algorithm,t)}_iterate(t,e){return Nt(this._ctx,t,e,this._ctx.table.core)}clone(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&H(n,t),e._ctx=n,e}raw(){return this._ctx.valueMapper=null,this}each(t){var e=this._ctx;return this._read(n=>Nt(e,t,n,e.table.core))}count(t){return this._read(e=>{let n=this._ctx,r=n.table.core;if(He(n,!0))return r.count({trans:e,query:{index:Jt(n,r.schema),range:n.range}}).then(s=>Math.min(s,n.limit));var i=0;return Nt(n,()=>(++i,!1),e,r).then(()=>i)}).then(t)}sortBy(t,e){let n=t.split(".").reverse(),r=n[0],i=n.length-1;function s(u,d){return d?s(u[n[d]],d-1):u[r]}var o=this._ctx.dir==="next"?1:-1;function a(u,d){var h=s(u,i),c=s(d,i);return h<c?-o:h>c?o:0}return this.toArray(function(u){return u.sort(a)}).then(e)}toArray(t){return this._read(e=>{var n=this._ctx;if(n.dir==="next"&&He(n,!0)&&n.limit>0){let{valueMapper:r}=n,i=Jt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(({result:s})=>r?s.map(r):s)}else{let r=[];return Nt(n,i=>r.push(i),e,n.table.core).then(()=>r)}},t)}offset(t){var e=this._ctx;return t<=0?this:(e.offset+=t,He(e)?Un(e,()=>{var n=t;return(r,i)=>n===0?!0:n===1?(--n,!1):(i(()=>{r.advance(n),n=0}),!1)}):Un(e,()=>{var n=t;return()=>--n<0}),this)}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Un(this._ctx,()=>{var e=t;return function(n,r,i){return--e<=0&&r(i),e>=0}},!0),this}until(t,e){return Qn(this._ctx,function(n,r,i){return t(n.value)?(r(i),e):!0}),this}first(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){return Qn(this._ctx,function(e){return t(e.value)}),va(this._ctx,t),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(n,r){t(r.key,r)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(n,r){t(r.primaryKey,r)})}keys(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each(function(r,i){n.push(i.key)}).then(function(){return n}).then(t)}primaryKeys(t){var e=this._ctx;if(e.dir==="next"&&He(e,!0)&&e.limit>0)return this._read(r=>{var i=Jt(e,e.table.core.schema);return e.table.core.query({trans:r,values:!1,limit:e.limit,query:{index:i,range:e.range}})}).then(({result:r})=>r).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each(function(r,i){n.push(i.primaryKey)}).then(function(){return n}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(e){return e[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var n={};return Qn(this._ctx,function(r){var i=r.primaryKey.toString(),s=V(n,i);return n[i]=!0,!s}),this}modify(t){var e=this._ctx;return this._write(n=>{var r;if(typeof t=="function")r=t;else{var i=j(t),s=i.length;r=function(y){for(var m=!1,p=0;p<s;++p){var b=i[p],C=t[b];ce(y,b)!==C&&(Z(y,b,C),m=!0)}return m}}let o=e.table.core,{outbound:a,extractKey:u}=o.schema.primaryKey,d=this.db._options.modifyChunkSize||200,h=[],c=0,l=[],f=(y,m)=>{let{failures:p,numFailures:b}=m;c+=y-b;for(let C of j(p))h.push(p[C])};return this.clone().primaryKeys().then(y=>{let m=p=>{let b=Math.min(d,y.length-p);return o.getMany({trans:n,keys:y.slice(p,p+b),cache:"immutable"}).then(C=>{let _=[],w=[],A=a?[]:null,v=[];for(let M=0;M<b;++M){let L=C[M],E={value:xt(L),primKey:y[p+M]};r.call(E,E.value,E)!==!1&&(E.value==null?v.push(y[p+M]):!a&&$(u(L),u(E.value))!==0?(v.push(y[p+M]),_.push(E.value)):(w.push(E.value),a&&A.push(y[p+M])))}let S=He(e)&&e.limit===1/0&&(typeof t!="function"||t===Kn)&&{index:e.index,range:e.range};return Promise.resolve(_.length>0&&o.mutate({trans:n,type:"add",values:_}).then(M=>{for(let L in M.failures)v.splice(parseInt(L),1);f(_.length,M)})).then(()=>(w.length>0||S&&typeof t=="object")&&o.mutate({trans:n,type:"put",keys:A,values:w,criteria:S,changeSpec:typeof t!="function"&&t}).then(M=>f(w.length,M))).then(()=>(v.length>0||S&&t===Kn)&&o.mutate({trans:n,type:"delete",keys:v,criteria:S}).then(M=>f(v.length,M))).then(()=>y.length>p+b&&m(p+d))})};return m(0).then(()=>{if(h.length>0)throw new Zt("Error modifying one or more objects",h,c,l);return y.length})})})}delete(){var t=this._ctx,e=t.range;return He(t)&&(t.isPrimKey&&!Ca||e.type===3)?this._write(n=>{let{primaryKey:r}=t.table.core.schema,i=e;return t.table.core.count({trans:n,query:{index:r,range:i}}).then(s=>t.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(({failures:o,lastResult:a,results:u,numFailures:d})=>{if(d)throw new Zt("Could not delete some values",Object.keys(o).map(h=>o[h]),s-d);return s-d}))}):this.modify(Kn)}},Kn=(t,e)=>e.value=null;function Ra(t){return kt(Sa.prototype,function(e,n){this.db=t;let r=Bi,i=null;if(n)try{r=n()}catch(u){i=u}let s=e._ctx,o=s.table,a=o.hook.reading.fire;this._ctx={table:o,index:s.index,isPrimKey:!s.index||o.schema.primKey.keyPath&&s.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:s.or,valueMapper:a!==At?a:null}})}function Ma(t,e){return t<e?-1:t===e?0:1}function ka(t,e){return t>e?-1:t===e?0:1}function W(t,e,n){var r=t instanceof Ni?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Ge(t){return new t.Collection(t,()=>qi("")).limit(0)}function Ta(t){return t==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function Ia(t){return t==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function Ea(t,e,n,r,i,s){for(var o=Math.min(t.length,r.length),a=-1,u=0;u<o;++u){var d=e[u];if(d!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[u],d)<0&&(a=u)}return o<r.length&&s==="next"?t+n.substr(t.length):o<t.length&&s==="prev"?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function $t(t,e,n,r){var i,s,o,a,u,d,h,c=n.length;if(!n.every(m=>typeof m=="string"))return W(t,Ki);function l(m){i=Ta(m),s=Ia(m),o=m==="next"?Ma:ka;var p=n.map(function(b){return{lower:s(b),upper:i(b)}}).sort(function(b,C){return o(b.lower,C.lower)});a=p.map(function(b){return b.upper}),u=p.map(function(b){return b.lower}),d=m,h=m==="next"?"":r}l("next");var f=new t.Collection(t,()=>be(a[0],u[c-1]+r));f._ondirectionchange=function(m){l(m)};var y=0;return f._addAlgorithm(function(m,p,b){var C=m.key;if(typeof C!="string")return!1;var _=s(C);if(e(_,u,y))return!0;for(var w=null,A=y;A<c;++A){var v=Ea(C,_,a[A],u[A],o,d);v===null&&w===null?y=A+1:(w===null||o(w,v)>0)&&(w=v)}return p(w!==null?function(){m.continue(w+h)}:b),!1}),f}function be(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function qi(t){return{type:1,lower:t,upper:t}}var Ni=class{get Collection(){return this._ctx.table.db.Collection}between(t,e,n,r){n=n!==!1,r=r===!0;try{return this._cmp(t,e)>0||this._cmp(t,e)===0&&(n||r)&&!(n&&r)?Ge(this):new this.Collection(this,()=>be(t,e,!n,!r))}catch{return W(this,ae)}}equals(t){return t==null?W(this,ae):new this.Collection(this,()=>qi(t))}above(t){return t==null?W(this,ae):new this.Collection(this,()=>be(t,void 0,!0))}aboveOrEqual(t){return t==null?W(this,ae):new this.Collection(this,()=>be(t,void 0,!1))}below(t){return t==null?W(this,ae):new this.Collection(this,()=>be(void 0,t,!1,!0))}belowOrEqual(t){return t==null?W(this,ae):new this.Collection(this,()=>be(void 0,t))}startsWith(t){return typeof t!="string"?W(this,Ki):this.between(t,t+Ie,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):$t(this,(e,n)=>e.indexOf(n[0])===0,[t],Ie)}equalsIgnoreCase(t){return $t(this,(e,n)=>e===n[0],[t],"")}anyOfIgnoreCase(){var t=le.apply(We,arguments);return t.length===0?Ge(this):$t(this,(e,n)=>n.indexOf(e)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=le.apply(We,arguments);return t.length===0?Ge(this):$t(this,(e,n)=>n.some(r=>e.indexOf(r)===0),t,Ie)}anyOf(){let t=le.apply(We,arguments),e=this._cmp;try{t.sort(e)}catch{return W(this,ae)}if(t.length===0)return Ge(this);let n=new this.Collection(this,()=>be(t[0],t[t.length-1]));n._ondirectionchange=i=>{e=i==="next"?this._ascending:this._descending,t.sort(e)};let r=0;return n._addAlgorithm((i,s,o)=>{let a=i.key;for(;e(a,t[r])>0;)if(++r,r===t.length)return s(o),!1;return e(a,t[r])===0?!0:(s(()=>{i.continue(t[r])}),!1)}),n}notEqual(t){return this.inAnyRange([[Zn,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let t=le.apply(We,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return W(this,ae)}let e=t.reduce((n,r)=>n?n.concat([[n[n.length-1][1],r]]):[[Zn,r]],null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){let n=this._cmp,r=this._ascending,i=this._descending,s=this._min,o=this._max;if(t.length===0)return Ge(this);if(!t.every(_=>_[0]!==void 0&&_[1]!==void 0&&r(_[0],_[1])<=0))return W(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",k.InvalidArgument);let a=!e||e.includeLowers!==!1,u=e&&e.includeUppers===!0;function d(_,w){let A=0,v=_.length;for(;A<v;++A){let S=_[A];if(n(w[0],S[1])<0&&n(w[1],S[0])>0){S[0]=s(S[0],w[0]),S[1]=o(S[1],w[1]);break}}return A===v&&_.push(w),_}let h=r;function c(_,w){return h(_[0],w[0])}let l;try{l=t.reduce(d,[]),l.sort(c)}catch{return W(this,ae)}let f=0,y=u?_=>r(_,l[f][1])>0:_=>r(_,l[f][1])>=0,m=a?_=>i(_,l[f][0])>0:_=>i(_,l[f][0])>=0;function p(_){return!y(_)&&!m(_)}let b=y,C=new this.Collection(this,()=>be(l[0][0],l[l.length-1][1],!a,!u));return C._ondirectionchange=_=>{_==="next"?(b=y,h=r):(b=m,h=i),l.sort(c)},C._addAlgorithm((_,w,A)=>{for(var v=_.key;b(v);)if(++f,f===l.length)return w(A),!1;return p(v)?!0:(this._cmp(v,l[f][1])===0||this._cmp(v,l[f][0])===0||w(()=>{h===r?_.continue(l[f][0]):_.continue(l[f][1])}),!1)}),C}startsWithAnyOf(){let t=le.apply(We,arguments);return t.every(e=>typeof e=="string")?t.length===0?Ge(this):this.inAnyRange(t.map(e=>[e,e+Ie])):W(this,"startsWithAnyOf() only works with strings")}};function Fa(t){return kt(Ni.prototype,function(e,n,r){this.db=t,this._ctx={table:e,index:n===":id"?null:n,or:r};let i=t._deps.indexedDB;if(!i)throw new k.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(s,o)=>i.cmp(o,s),this._max=(s,o)=>i.cmp(s,o)>0?s:o,this._min=(s,o)=>i.cmp(s,o)<0?s:o,this._IDBKeyRange=t._deps.IDBKeyRange})}function te(t){return O(function(e){return Ct(e),t(e.target.error),!1})}function Ct(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var _t="storagemutated",_e="x-storagemutated-1",xe=Mt(null,_t),Pa=class{_lock(){return ct(!R.global),++this._reculock,this._reculock===1&&!R.global&&(R.lockOwnerFor=this),this}_unlock(){if(ct(!R.global),--this._reculock===0)for(R.global||(R.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Ze(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&R.lockOwnerFor!==this}create(t){if(!this.mode)return this;let e=this.db.idbdb,n=this.db._state.dbOpenError;if(ct(!this.idbtrans),!t&&!e)switch(n&&n.name){case"DatabaseClosedError":throw new k.DatabaseClosed(n);case"MissingAPIError":throw new k.MissingAPI(n.message,n);default:throw new k.OpenFailed(n)}if(!this.active)throw new k.TransactionInactive;return ct(this._completion._state===null),t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),t.onerror=O(r=>{Ct(r),this._reject(t.error)}),t.onabort=O(r=>{Ct(r),this.active&&this._reject(new k.Abort(t.error)),this.active=!1,this.on("abort").fire(r)}),t.oncomplete=O(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&xe.storagemutated.fire(t.mutatedParts)}),this}_promise(t,e,n){if(t==="readwrite"&&this.mode!=="readwrite")return Q(new k.ReadOnly("Transaction is readonly"));if(!this.active)return Q(new k.TransactionInactive);if(this._locked())return new x((i,s)=>{this._blockedFuncs.push([()=>{this._promise(t,e,n).then(i,s)},R])});if(n)return we(()=>{var i=new x((s,o)=>{this._lock();let a=e(s,o,this);a&&a.then&&a.then(s,o)});return i.finally(()=>this._unlock()),i._lib=!0,i});var r=new x((i,s)=>{var o=e(i,s,this);o&&o.then&&o.then(i,s)});return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(t){var e=this._root();let n=x.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then(()=>n);else{e._waitingFor=n,e._waitingQueue=[];var r=e.idbtrans.objectStore(e.storeNames[0]);(function s(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(r.get(-1/0).onsuccess=s)})()}var i=e._waitingFor;return new x((s,o)=>{n.then(a=>e._waitingQueue.push(O(s.bind(null,a))),a=>e._waitingQueue.push(O(o.bind(null,a)))).finally(()=>{e._waitingFor===i&&(e._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new k.Abort))}table(t){let e=this._memoizedTables||(this._memoizedTables={});if(V(e,t))return e[t];let n=this.schema[t];if(!n)throw new k.NotFound("Table "+t+" not part of transaction");let r=new this.db.Table(t,n,this);return r.core=this.db.core.table(t),e[t]=r,r}};function Oa(t){return kt(Pa.prototype,function(e,n,r,i,s){this.db=t,this.mode=e,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Mt(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new x((o,a)=>{this._resolve=o,this._reject=a}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},o=>{var a=this.active;return this.active=!1,this.on.error.fire(o),this.parent?this.parent._reject(o):a&&this.idbtrans&&this.idbtrans.abort(),Q(o)})})}function er(t,e,n,r,i,s,o){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+$i(e)}}function $i(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Hi(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:vi(n,r=>[r.name,r])}}function La(t){return t.length===1?t[0]:t}var wt=t=>{try{return t.only([[]]),wt=()=>[[]],[[]]}catch{return wt=()=>Ie,Ie}};function tr(t){return t==null?()=>{}:typeof t=="string"?ja(t):e=>ce(e,t)}function ja(t){return t.split(".").length===1?e=>e[t]:e=>ce(e,t)}function gi(t){return[].slice.call(t)}var Qa=0;function gt(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Ua(t,e,n){function r(h,c){let l=gi(h.objectStoreNames);return{schema:{name:h.name,tables:l.map(f=>c.objectStore(f)).map(f=>{let{keyPath:y,autoIncrement:m}=f,p=B(y),b=y==null,C={},_={name:f.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b,compound:p,keyPath:y,autoIncrement:m,unique:!0,extractKey:tr(y)},indexes:gi(f.indexNames).map(w=>f.index(w)).map(w=>{let{name:A,unique:v,multiEntry:S,keyPath:M}=w,L=B(M),E={name:A,compound:L,keyPath:M,unique:v,multiEntry:S,extractKey:tr(M)};return C[gt(M)]=E,E}),getIndexByKeyPath:w=>C[gt(w)]};return C[":id"]=_.primaryKey,y!=null&&(C[gt(y)]=_.primaryKey),_})},hasGetAll:l.length>0&&"getAll"in c.objectStore(l[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(h){if(h.type===3)return null;if(h.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:c,upper:l,lowerOpen:f,upperOpen:y}=h;return c===void 0?l===void 0?null:e.upperBound(l,!!y):l===void 0?e.lowerBound(c,!!f):e.bound(c,l,!!f,!!y)}function s(h){let c=h.name;function l({trans:m,type:p,keys:b,values:C,range:_}){return new Promise((w,A)=>{w=O(w);let v=m.objectStore(c),S=v.keyPath==null,M=p==="put"||p==="add";if(!M&&p!=="delete"&&p!=="deleteRange")throw new Error("Invalid operation type: "+p);let{length:L}=b||C||{length:1};if(b&&C&&b.length!==C.length)throw new Error("Given keys array must have same length as given values array.");if(L===0)return w({numFailures:0,failures:{},results:[],lastResult:void 0});let E,I=[],z=[],T=0,J=G=>{++T,Ct(G)};if(p==="deleteRange"){if(_.type===4)return w({numFailures:T,failures:z,results:[],lastResult:void 0});_.type===3?I.push(E=v.clear()):I.push(E=v.delete(i(_)))}else{let[G,Y]=M?S?[C,b]:[C,null]:[b,null];if(M)for(let U=0;U<L;++U)I.push(E=Y&&Y[U]!==void 0?v[p](G[U],Y[U]):v[p](G[U])),E.onerror=J;else for(let U=0;U<L;++U)I.push(E=v[p](G[U])),E.onerror=J}let X=G=>{let Y=G.target.result;I.forEach((U,et)=>U.error!=null&&(z[et]=U.error)),w({numFailures:T,failures:z,results:p==="delete"?b:I.map(U=>U.result),lastResult:Y})};E.onerror=G=>{J(G),X(G)},E.onsuccess=X})}function f({trans:m,values:p,query:b,reverse:C,unique:_}){return new Promise((w,A)=>{w=O(w);let{index:v,range:S}=b,M=m.objectStore(c),L=v.isPrimaryKey?M:M.index(v.name),E=C?_?"prevunique":"prev":_?"nextunique":"next",I=p||!("openKeyCursor"in L)?L.openCursor(i(S),E):L.openKeyCursor(i(S),E);I.onerror=te(A),I.onsuccess=O(z=>{let T=I.result;if(!T){w(null);return}T.___id=++Qa,T.done=!1;let J=T.continue.bind(T),X=T.continuePrimaryKey;X&&(X=X.bind(T));let G=T.advance.bind(T),Y=()=>{throw new Error("Cursor not started")},U=()=>{throw new Error("Cursor not stopped")};T.trans=m,T.stop=T.continue=T.continuePrimaryKey=T.advance=Y,T.fail=O(A),T.next=function(){let et=1;return this.start(()=>et--?this.continue():this.stop()).then(()=>this)},T.start=et=>{let Yi=new Promise((je,Ar)=>{je=O(je),I.onerror=te(Ar),T.fail=Ar,T.stop=Ji=>{T.stop=T.continue=T.continuePrimaryKey=T.advance=U,je(Ji)}}),mn=()=>{if(I.result)try{et()}catch(je){T.fail(je)}else T.done=!0,T.start=()=>{throw new Error("Cursor behind last entry")},T.stop()};return I.onsuccess=O(je=>{I.onsuccess=mn,mn()}),T.continue=J,T.continuePrimaryKey=X,T.advance=G,mn(),Yi},w(T)},A)})}function y(m){return p=>new Promise((b,C)=>{b=O(b);let{trans:_,values:w,limit:A,query:v}=p,S=A===1/0?void 0:A,{index:M,range:L}=v,E=_.objectStore(c),I=M.isPrimaryKey?E:E.index(M.name),z=i(L);if(A===0)return b({result:[]});if(m){let T=w?I.getAll(z,S):I.getAllKeys(z,S);T.onsuccess=J=>b({result:J.target.result}),T.onerror=te(C)}else{let T=0,J=w||!("openKeyCursor"in I)?I.openCursor(z):I.openKeyCursor(z),X=[];J.onsuccess=G=>{let Y=J.result;if(!Y)return b({result:X});if(X.push(w?Y.value:Y.primaryKey),++T===A)return b({result:X});Y.continue()},J.onerror=te(C)}})}return{name:c,schema:h,mutate:l,getMany({trans:m,keys:p}){return new Promise((b,C)=>{b=O(b);let _=m.objectStore(c),w=p.length,A=new Array(w),v=0,S=0,M,L=I=>{let z=I.target;(A[z._pos]=z.result)!=null,++S===v&&b(A)},E=te(C);for(let I=0;I<w;++I)p[I]!=null&&(M=_.get(p[I]),M._pos=I,M.onsuccess=L,M.onerror=E,++v);v===0&&b(A)})},get({trans:m,key:p}){return new Promise((b,C)=>{b=O(b);let _=m.objectStore(c).get(p);_.onsuccess=w=>b(w.target.result),_.onerror=te(C)})},query:y(a),openCursor:f,count({query:m,trans:p}){let{index:b,range:C}=m;return new Promise((_,w)=>{let A=p.objectStore(c),v=b.isPrimaryKey?A:A.index(b.name),S=i(C),M=S?v.count(S):v.count();M.onsuccess=O(L=>_(L.target.result)),M.onerror=te(w)})}}}let{schema:o,hasGetAll:a}=r(t,n),u=o.tables.map(h=>s(h)),d={};return u.forEach(h=>d[h.name]=h),{stack:"dbcore",transaction:t.transaction.bind(t),table(h){if(!d[h])throw new Error(`Table '${h}' not found`);return d[h]},MIN_KEY:-1/0,MAX_KEY:wt(e),schema:o}}function Ka(t,e){return e.reduce((n,{create:r})=>({...n,...r(n)}),t)}function Da(t,e,{IDBKeyRange:n,indexedDB:r},i){return{dbcore:Ka(Ua(e,n,i),t.dbcore)}}function fr({_novip:t},e){let n=e.db,r=Da(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(i=>{let s=i.name;t.core.schema.tables.some(o=>o.name===s)&&(i.core=t.core.table(s),t[s]instanceof t.Table&&(t[s].core=i.core))})}function on({_novip:t},e,n,r){n.forEach(i=>{let s=r[i];e.forEach(o=>{let a=lr(o,i);(!a||"value"in a&&a.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?he(o,i,{get(){return this.table(i)},set(u){Ci(this,i,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new t.Table(i,s))})})}function nr({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Ba(t,e){return t._cfg.version-e._cfg.version}function qa(t,e,n,r){let i=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,i);s.create(n),s._completion.catch(r);let o=s._reject.bind(s),a=R.transless||R;we(()=>{R.trans=s,R.transless=a,e===0?(j(i).forEach(u=>{br(n,u,i[u].primKey,i[u].indexes)}),fr(t,n),x.follow(()=>t.on.populate.fire(s)).catch(o)):Na(t,e,s,n).catch(o)})}function Na({_novip:t},e,n,r){let i=[],s=t._versions,o=t._dbSchema=Cr(t,t.idbdb,r),a=!1;s.filter(d=>d._cfg.version>=e).forEach(d=>{i.push(()=>{let h=o,c=d._cfg.dbschema;ir(t,h,r),ir(t,c,r),o=t._dbSchema=c;let l=Gi(h,c);l.add.forEach(y=>{br(r,y[0],y[1].primKey,y[1].indexes)}),l.change.forEach(y=>{if(y.recreate)throw new k.Upgrade("Not yet support for changing primary key");{let m=r.objectStore(y.name);y.add.forEach(p=>rr(m,p)),y.change.forEach(p=>{m.deleteIndex(p.name),rr(m,p)}),y.del.forEach(p=>m.deleteIndex(p))}});let f=d._cfg.contentUpgrade;if(f&&d._cfg.version>e){fr(t,r),n._memoizedTables={},a=!0;let y=xi(c);l.del.forEach(C=>{y[C]=h[C]}),nr(t,[t.Transaction.prototype]),on(t,[t.Transaction.prototype],j(y),y),n.schema=y;let m=dr(f);m&&Xe();let p,b=x.follow(()=>{if(p=f(n),p&&m){var C=pe.bind(null,null);p.then(C,C)}});return p&&typeof p.then=="function"?x.resolve(p):b.then(()=>p)}}),i.push(h=>{if(!a||!ba){let c=d._cfg.dbschema;Ha(c,h)}nr(t,[t.Transaction.prototype]),on(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),n.schema=t._dbSchema})});function u(){return i.length?x.resolve(i.shift()(n.idbtrans)).then(u):x.resolve()}return u().then(()=>{$a(o,r)})}function Gi(t,e){let n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){let i=t[r],s=e[r];if(!i)n.add.push([r,s]);else{let o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!cn)o.recreate=!0,n.change.push(o);else{let a=i.idxByName,u=s.idxByName,d;for(d in a)u[d]||o.del.push(d);for(d in u){let h=a[d],c=u[d];h?h.src!==c.src&&o.change.push(c):o.add.push(c)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}}return n}function br(t,e,n,r){let i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>rr(i,s)),i}function $a(t,e){j(t).forEach(n=>{e.db.objectStoreNames.contains(n)||br(e,n,t[n].primKey,t[n].indexes)})}function Ha(t,e){[].slice.call(e.db.objectStoreNames).forEach(n=>t[n]==null&&e.db.deleteObjectStore(n))}function rr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Cr(t,e,n){let r={};return ln(e.objectStoreNames,0).forEach(i=>{let s=n.objectStore(i),o=s.keyPath,a=er($i(o),o||"",!1,!1,!!s.autoIncrement,o&&typeof o!="string",!0),u=[];for(let h=0;h<s.indexNames.length;++h){let c=s.index(s.indexNames[h]);o=c.keyPath;var d=er(c.name,o,!!c.unique,!!c.multiEntry,!1,o&&typeof o!="string",!1);u.push(d)}r[i]=Hi(i,a,u)}),r}function Ga({_novip:t},e,n){t.verno=e.version/10;let r=t._dbSchema=Cr(t,e,n);t._storeNames=ln(e.objectStoreNames,0),on(t,[t._allTables],j(r),r)}function Wa(t,e){let n=Cr(t,t.idbdb,e),r=Gi(n,t._dbSchema);return!(r.add.length||r.change.some(i=>i.add.length||i.change.length))}function ir({_novip:t},e,n){let r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){let s=r[i],o=n.objectStore(s);t._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let u=o.indexNames[a],d=o.index(u).keyPath,h=typeof d=="string"?d:"["+ln(d).join("+")+"]";if(e[s]){let c=e[s].idxByName[h];c&&(c.name=u,delete e[s].idxByName[h],e[s].idxByName[u]=c)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&P.WorkerGlobalScope&&P instanceof P.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Va(t){return t.split(",").map((e,n)=>{e=e.trim();let r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return er(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),B(i),n===0)})}var za=class{_parseStoresSpec(t,e){j(t).forEach(n=>{if(t[n]!==null){var r=Va(t[n]),i=r.shift();if(i.multi)throw new k.Schema("Primary key cannot be multi-valued");r.forEach(s=>{if(s.auto)throw new k.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new k.Schema("Index must have a name and cannot be an empty string")}),e[n]=Hi(n,i,r)}})}stores(t){let e=this.db;this._cfg.storesSource=this._cfg.storesSource?H(this._cfg.storesSource,t):t;let n=e._versions,r={},i={};return n.forEach(s=>{H(r,s._cfg.storesSource),i=s._cfg.dbschema={},s._parseStoresSpec(r,i)}),e._dbSchema=i,nr(e,[e._allTables,e,e.Transaction.prototype]),on(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],j(i),i),e._storeNames=j(i),this}upgrade(t){return this._cfg.contentUpgrade=pr(this._cfg.contentUpgrade||F,t),this}};function Ya(t){return kt(za.prototype,function(e){this.db=t,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function _r(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new Tt(hn,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function wr(t){return t&&typeof t.databases=="function"}function Ja({indexedDB:t,IDBKeyRange:e}){return wr(t)?Promise.resolve(t.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==hn)):_r(t,e).toCollection().primaryKeys()}function Xa({indexedDB:t,IDBKeyRange:e},n){!wr(t)&&n!==hn&&_r(t,e).put({name:n}).catch(F)}function Za({indexedDB:t,IDBKeyRange:e},n){!wr(t)&&n!==hn&&_r(t,e).delete(n).catch(F)}function sr(t){return we(function(){return R.letThrough=!0,t()})}function eu(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function tu(t){let e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Q(e.dbOpenError):t);ne&&(e.openCanceller._stackHolder=Le()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new k.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1,u=()=>new x((d,h)=>{if(i(),!n)throw new k.MissingAPI;let c=t.name,l=e.autoSchema?n.open(c):n.open(c,Math.round(t.verno*10));if(!l)throw new k.MissingAPI;l.onerror=te(h),l.onblocked=O(t._fireOnBlocked),l.onupgradeneeded=O(f=>{if(o=l.transaction,e.autoSchema&&!t._options.allowEmptyDB){l.onerror=Ct,o.abort(),l.result.close();let m=n.deleteDatabase(c);m.onsuccess=m.onerror=O(()=>{h(new k.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{o.onerror=te(h);var y=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=y<1,t._novip.idbdb=l.result,qa(t,y/10,o,h)}},h),l.onsuccess=O(()=>{o=null;let f=t._novip.idbdb=l.result,y=ln(f.objectStoreNames);if(y.length>0)try{let m=f.transaction(La(y),"readonly");e.autoSchema?Ga(t,f,m):(ir(t,t._dbSchema,m),Wa(t,m)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),fr(t,m)}catch{}mt.push(t),f.onversionchange=O(m=>{e.vcFired=!0,t.on("versionchange").fire(m)}),f.onclose=O(m=>{t.on("close").fire(m)}),a&&Xa(t._deps,c),d()},h)}).catch(d=>d&&d.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u()):x.reject(d));return x.race([r,(typeof navigator>"u"?x.resolve():eu()).then(u)]).then(()=>(i(),e.onReadyBeingFired=[],x.resolve(sr(()=>t.on.ready.fire(t.vip))).then(function d(){if(e.onReadyBeingFired.length>0){let h=e.onReadyBeingFired.reduce(pr,F);return e.onReadyBeingFired=[],x.resolve(sr(()=>h(t.vip))).then(d)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(d=>{e.dbOpenError=d;try{o&&o.abort()}catch{}return r===e.openCanceller&&t._close(),Q(d)}).finally(()=>{e.openComplete=!0,s()})}function or(t){var e=o=>t.next(o),n=o=>t.throw(o),r=s(e),i=s(n);function s(o){return a=>{var u=o(a),d=u.value;return u.done?d:!d||typeof d.then!="function"?B(d)?Promise.all(d).then(r,i):r(d):d.then(r,i)}}return s(e)()}function nu(t,e,n){var r=arguments.length;if(r<2)throw new k.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var s=Ai(i);return[t,s,n]}function Wi(t,e,n,r,i){return x.resolve().then(()=>{let s=R.transless||R,o=t._createTransaction(e,n,t._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(c){return c.name===hr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Wi(t,e,n,null,i))):Q(c)}let u=dr(i);u&&Xe();let d,h=x.follow(()=>{if(d=i.call(o,o),d)if(u){var c=pe.bind(null,null);d.then(c,c)}else typeof d.next=="function"&&typeof d.throw=="function"&&(d=or(d))},a);return(d&&typeof d.then=="function"?x.resolve(d).then(c=>o.active?c:Q(new k.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>d)).then(c=>(r&&o._resolve(),o._completion.then(()=>c))).catch(c=>(o._reject(c),Q(c)))})}function Ht(t,e,n){let r=B(t)?t.slice():[t];for(let i=0;i<n;++i)r.push(e);return r}function ru(t){return{...t,table(e){let n=t.table(e),{schema:r}=n,i={},s=[];function o(c,l,f){let y=gt(c),m=i[y]=i[y]||[],p=c==null?0:typeof c=="string"?1:c.length,b=l>0,C={...f,isVirtual:b,keyTail:l,keyLength:p,extractKey:tr(c),unique:!b&&f.unique};if(m.push(C),C.isPrimaryKey||s.push(C),p>1){let _=p===2?c[0]:c.slice(0,p-1);o(_,l+1,f)}return m.sort((_,w)=>_.keyTail-w.keyTail),C}let a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(let c of r.indexes)o(c.keyPath,0,c);function u(c){let l=i[gt(c)];return l&&l[0]}function d(c,l){return{type:c.type===1?2:c.type,lower:Ht(c.lower,c.lowerOpen?t.MAX_KEY:t.MIN_KEY,l),lowerOpen:!0,upper:Ht(c.upper,c.upperOpen?t.MIN_KEY:t.MAX_KEY,l),upperOpen:!0}}function h(c){let l=c.query.index;return l.isVirtual?{...c,query:{index:l,range:d(c.query.range,l.keyTail)}}:c}return{...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:u},count(c){return n.count(h(c))},query(c){return n.query(h(c))},openCursor(c){let{keyTail:l,isVirtual:f,keyLength:y}=c.query.index;if(!f)return n.openCursor(c);function m(p){function b(C){C!=null?p.continue(Ht(C,c.reverse?t.MAX_KEY:t.MIN_KEY,l)):c.unique?p.continue(p.key.slice(0,y).concat(c.reverse?t.MIN_KEY:t.MAX_KEY,l)):p.continue()}return Object.create(p,{continue:{value:b},continuePrimaryKey:{value(C,_){p.continuePrimaryKey(Ht(C,t.MAX_KEY,l),_)}},primaryKey:{get(){return p.primaryKey}},key:{get(){let C=p.key;return y===1?C[0]:C.slice(0,y)}},value:{get(){return p.value}}})}return n.openCursor(h(c)).then(p=>p&&m(p))}}}}}var iu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:ru};function vr(t,e,n,r){return n=n||{},r=r||"",j(t).forEach(i=>{if(!V(e,i))n[r+i]=void 0;else{var s=t[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=Bn(s),u=Bn(o);a!==u?n[r+i]=e[i]:a==="Object"?vr(s,o,n,r+i+"."):s!==o&&(n[r+i]=e[i])}else s!==o&&(n[r+i]=e[i])}}),j(e).forEach(i=>{V(t,i)||(n[r+i]=e[i])}),n}function su(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var ou={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){let n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(i){let s=R.trans,{deleting:o,creating:a,updating:u}=s.table(e).hook;switch(i.type){case"add":if(a.fire===F)break;return s._promise("readwrite",()=>d(i),!0);case"put":if(a.fire===F&&u.fire===F)break;return s._promise("readwrite",()=>d(i),!0);case"delete":if(o.fire===F)break;return s._promise("readwrite",()=>d(i),!0);case"deleteRange":if(o.fire===F)break;return s._promise("readwrite",()=>h(i),!0)}return n.mutate(i);function d(l){let f=R.trans,y=l.keys||su(r,l);if(!y)throw new Error("Keys missing");return l=l.type==="add"||l.type==="put"?{...l,keys:y}:{...l},l.type!=="delete"&&(l.values=[...l.values]),l.keys&&(l.keys=[...l.keys]),au(n,l,y).then(m=>{let p=y.map((b,C)=>{let _=m[C],w={onerror:null,onsuccess:null};if(l.type==="delete")o.fire.call(w,b,_,f);else if(l.type==="add"||_===void 0){let A=a.fire.call(w,b,l.values[C],f);b==null&&A!=null&&(b=A,l.keys[C]=b,r.outbound||Z(l.values[C],r.keyPath,b))}else{let A=vr(_,l.values[C]),v=u.fire.call(w,A,b,_,f);if(v){let S=l.values[C];Object.keys(v).forEach(M=>{V(S,M)?S[M]=v[M]:Z(S,M,v[M])})}}return w});return n.mutate(l).then(({failures:b,results:C,numFailures:_,lastResult:w})=>{for(let A=0;A<y.length;++A){let v=C?C[A]:y[A],S=p[A];v==null?S.onerror&&S.onerror(b[A]):S.onsuccess&&S.onsuccess(l.type==="put"&&m[A]?l.values[A]:v)}return{failures:b,results:C,numFailures:_,lastResult:w}}).catch(b=>(p.forEach(C=>C.onerror&&C.onerror(b)),Promise.reject(b)))})}function h(l){return c(l.trans,l.range,1e4)}function c(l,f,y){return n.query({trans:l,values:!1,query:{index:r,range:f},limit:y}).then(({result:m})=>d({type:"delete",keys:m,trans:l}).then(p=>p.numFailures>0?Promise.reject(p.failures[0]):m.length<y?{failures:[],numFailures:0,lastResult:void 0}:c(l,{...f,lower:m[m.length-1],lowerOpen:!0},y)))}}}}})};function au(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function Vi(t,e,n){try{if(!e||e.keys.length<t.length)return null;let r=[];for(let i=0,s=0;i<e.keys.length&&s<t.length;++i)$(e.keys[i],t[s])===0&&(r.push(n?xt(e.values[i]):e.values[i]),++s);return r.length===t.length?r:null}catch{return null}}var uu={stack:"dbcore",level:-1,create:t=>({table:e=>{let n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);let i=Vi(r.keys,r.trans._cache,r.cache==="clone");return i?x.resolve(i):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?xt(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function xr(t){return!("from"in t)}var ue=function(t,e){if(this)H(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{let n=new ue;return t&&"d"in t&&H(n,t),n}};ze(ue.prototype,{add(t){return an(this,t),this},addKey(t){return vt(this,t,t),this},addKeys(t){return t.forEach(e=>vt(this,e,e)),this},[qn](){return ar(this)}});function vt(t,e,n){let r=$(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(xr(t))return H(t,{from:e,to:n,d:1});let i=t.l,s=t.r;if($(n,t.from)<0)return i?vt(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},yi(t);if($(e,t.to)>0)return s?vt(s,e,n):t.r={from:e,to:n,d:1,l:null,r:null},yi(t);$(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),$(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);let o=!t.r;i&&!t.l&&an(t,i),s&&o&&an(t,s)}function an(t,e){function n(r,{from:i,to:s,l:o,r:a}){vt(r,i,s),o&&n(r,o),a&&n(r,a)}xr(e)||n(t,e)}function lu(t,e){let n=ar(e),r=n.next();if(r.done)return!1;let i=r.value,s=ar(t),o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if($(a.from,i.to)<=0&&$(a.to,i.from)>=0)return!0;$(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function ar(t){let e=xr(t)?null:{s:0,n:t};return{next(n){let r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&$(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||$(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function yi(t){var e,n;let r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){let s=i==="r"?"l":"r",o={...t},a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],o[i]=a[s],t[s]=o,o.d=fi(o)}t.d=fi(t)}function fi({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}var du={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,n=new ue(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{let i=t.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:u}=o,d={...i,mutate:l=>{let f=l.trans,y=f.mutatedParts||(f.mutatedParts={}),m=v=>{let S=`idb://${e}/${r}/${v}`;return y[S]||(y[S]=new ue)},p=m(""),b=m(":dels"),{type:C}=l,[_,w]=l.type==="deleteRange"?[l.range]:l.type==="delete"?[l.keys]:l.values.length<50?[[],l.values]:[],A=l.trans._cache;return i.mutate(l).then(v=>{if(B(_)){C!=="delete"&&(_=v.results),p.addKeys(_);let S=Vi(_,A);!S&&C!=="add"&&b.addKeys(_),(S||w)&&cu(m,s,S,w)}else if(_){let S={from:_.lower,to:_.upper};b.add(S),p.add(S)}else p.add(n),b.add(n),s.indexes.forEach(S=>m(S.name).add(n));return v})}},h=({query:{index:l,range:f}})=>{var y,m;return[l,new ue((y=f.lower)!==null&&y!==void 0?y:t.MIN_KEY,(m=f.upper)!==null&&m!==void 0?m:t.MAX_KEY)]},c={get:l=>[o,new ue(l.key)],getMany:l=>[o,new ue().addKeys(l.keys)],count:h,query:h,openCursor:h};return j(c).forEach(l=>{d[l]=function(f){let{subscr:y}=R;if(y){let m=w=>{let A=`idb://${e}/${r}/${w}`;return y[A]||(y[A]=new ue)},p=m(""),b=m(":dels"),[C,_]=c[l](f);if(m(C.name||"").add(_),!C.isPrimaryKey)if(l==="count")b.add(n);else{let w=l==="query"&&u&&f.values&&i.query({...f,values:!1});return i[l].apply(this,arguments).then(A=>{if(l==="query"){if(u&&f.values)return w.then(({result:S})=>(p.addKeys(S),A));let v=f.values?A.result.map(a):A.result;f.values?p.addKeys(v):b.addKeys(v)}else if(l==="openCursor"){let v=A,S=f.values;return v&&Object.create(v,{key:{get(){return b.addKey(v.primaryKey),v.key}},primaryKey:{get(){let M=v.primaryKey;return b.addKey(M),M}},value:{get(){return S&&p.addKey(v.primaryKey),v.value}}})}return A})}}return i[l].apply(this,arguments)}}),d}}}};function cu(t,e,n,r){function i(s){let o=t(s.name||"");function a(d){return d!=null?s.extractKey(d):null}let u=d=>s.multiEntry&&B(d)?d.forEach(h=>o.addKey(h)):o.addKey(d);(n||r).forEach((d,h)=>{let c=n&&a(n[h]),l=r&&a(r[h]);$(c,l)!==0&&(c!=null&&u(c),l!=null&&u(l))})}e.indexes.forEach(i)}var Tt=class Xt{constructor(e,n){this._middlewares={},this.verno=0;let r=Xt.dependencies;this._options=n={addons:Xt.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};let{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:F,dbReadyPromise:null,cancelOpen:F,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new x(o=>{s.dbReadyResolve=o}),s.openCanceller=new x((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=Mt(this,"populate","blocked","versionchange","close",{ready:[pr,F]}),this.on.ready.subscribe=_i(this.on.ready.subscribe,o=>(a,u)=>{Xt.vip(()=>{let d=this._state;if(d.openComplete)d.dbOpenError||x.resolve().then(a),u&&o(a);else if(d.onReadyBeingFired)d.onReadyBeingFired.push(a),u&&o(a);else{o(a);let h=this;u||o(function c(){h.on.ready.unsubscribe(a),h.on.ready.unsubscribe(c)})}})}),this.Collection=Ra(this),this.Table=wa(this),this.Transaction=Oa(this),this.Version=Ya(this),this.WhereClause=Fa(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=wt(n.IDBKeyRange),this._createTransaction=(o,a,u,d)=>new this.Transaction(o,a,u,this._options.chromeTransactionDurability,d),this._fireOnBlocked=o=>{this.on("blocked").fire(o),mt.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(iu),this.use(ou),this.use(du),this.use(uu),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new k.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new k.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let n=this._versions;var r=n.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ba),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||R.letThrough||this._vip)?e():new x((n,r)=>{if(this._state.openComplete)return r(new k.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){r(new k.DatabaseClosed);return}this.open().catch(F)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:n,level:r??10,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:n?i.name!==n:!1)),this}open(){return tu(this)}_close(){let e=this._state,n=mt.indexOf(this);if(n>=0&&mt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new x(r=>{e.dbReadyResolve=r}),e.openCanceller=new x((r,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new k.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,n=this._state;return new x((r,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=O(()=>{Za(this._deps,this.name),r()}),o.onerror=te(i),o.onblocked=this._fireOnBlocked};if(e)throw new k.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return j(this._allTables).map(e=>this._allTables[e])}transaction(){let e=nu.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let i=R.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=n.map(d=>{var h=d instanceof this.Table?d.name:d;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),e=="r"||e===Ln)o=Ln;else if(e=="rw"||e==jn)o=jn;else throw new k.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===Ln&&o===jn)if(s)i=null;else throw new k.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(d=>{if(i&&i.storeNames.indexOf(d)===-1)if(s)i=null;else throw new k.SubTransaction("Table "+d+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(d){return i?i._promise(null,(h,c)=>{c(d)}):Q(d)}let u=Wi.bind(null,this,o,a,i,r);return i?i._promise(o,u,"lock"):R.trans?Ze(R.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!V(this._allTables,e))throw new k.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},hu=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",pu=class{constructor(t){this._subscribe=t}subscribe(t,e,n){return this._subscribe(!t||typeof t=="function"?{next:t,error:e,complete:n}:t)}[hu](){return this}};function zi(t,e){return j(e).forEach(n=>{let r=t[n]||(t[n]=new ue);an(r,e[n])}),t}function mu(t){let e=!1,n,r=new pu(i=>{let s=dr(t);function o(p){s&&Xe();let b=()=>we(t,{subscr:p,trans:null}),C=R.trans?Ze(R.transless,b):b();return s&&C.then(pe,pe),C}let a=!1,u={},d={},h={get closed(){return a},unsubscribe:()=>{a=!0,xe.storagemutated.unsubscribe(y)}};i.start&&i.start(h);let c=!1,l=!1;function f(){return j(d).some(p=>u[p]&&lu(u[p],d[p]))}let y=p=>{zi(u,p),f()&&m()},m=()=>{if(c||a)return;u={};let p={},b=o(p);l||(xe(_t,y),l=!0),c=!0,Promise.resolve(b).then(C=>{e=!0,n=C,c=!1,!a&&(f()?m():(u={},d=p,i.next&&i.next(C)))},C=>{c=!1,e=!1,i.error&&i.error(C),h.unsubscribe()})};return m(),h});return r.hasValue=()=>e,r.getValue=()=>n,r}var ur;try{ur={indexedDB:P.indexedDB||P.mozIndexedDB||P.webkitIndexedDB||P.msIndexedDB,IDBKeyRange:P.IDBKeyRange||P.webkitIDBKeyRange}}catch{ur={indexedDB:null,IDBKeyRange:null}}var Te=Tt;ze(Te,{...dn,delete(t){return new Te(t,{addons:[]}).delete()},exists(t){return new Te(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(t){try{return Ja(Te.dependencies).then(t)}catch{return Q(new k.MissingAPI)}},defineClass(){function t(e){H(this,e)}return t},ignoreTransaction(t){return R.trans?Ze(R.transless,t):t()},vip:sr,async:function(t){return function(){try{var e=or(t.apply(this,arguments));return!e||typeof e.then!="function"?x.resolve(e):e}catch(n){return Q(n)}}},spawn:function(t,e,n){try{var r=or(t.apply(n,e||[]));return!r||typeof r.then!="function"?x.resolve(r):r}catch(i){return Q(i)}},currentTransaction:{get:()=>R.trans||null},waitFor:function(t,e){let n=x.resolve(typeof t=="function"?Te.ignoreTransaction(t):t).timeout(e||6e4);return R.trans?R.trans.waitFor(n):n},Promise:x,debug:{get:()=>ne,set:t=>{Ri(t,t==="dexie"?()=>!0:Di)}},derive:Ye,extend:H,props:ze,override:_i,Events:Mt,on:xe,liveQuery:mu,extendObservabilitySet:zi,getByKeyPath:ce,setByKeyPath:Z,delByKeyPath:Go,shallowClone:xi,deepClone:xt,getObjectDiff:vr,cmp:$,asap:wi,minKey:Zn,addons:[],connections:mt,errnames:hr,dependencies:ur,semVer:di,version:di.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,n*2))});Te.maxKey=wt(Te.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(xe(_t,t=>{if(!de){let e;cn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(_e,!0,!0,t)):e=new CustomEvent(_e,{detail:t}),de=!0,dispatchEvent(e),de=!1}}),addEventListener(_e,({detail:t})=>{de||un(t)}));function un(t){let e=de;try{de=!0,xe.storagemutated.fire(t)}finally{de=e}}var de=!1;if(typeof BroadcastChannel<"u"){let t=new BroadcastChannel(_e);typeof t.unref=="function"&&t.unref(),xe(_t,e=>{de||t.postMessage(e)}),t.onmessage=e=>{e.data&&un(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){xe(_t,e=>{try{de||(typeof localStorage<"u"&&localStorage.setItem(_e,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:_e,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===_e){let n=JSON.parse(e.newValue);n&&un(n.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",gu)}function gu({data:t}){t&&t.type===_e&&un(t.changedParts)}x.rejectionMapper=ta;Ri(ne,Di);var pn=class extends Tt{updates;constructor(e){super(`update-explorer_${e}`),this.version(1).stores({updates:"++id, &updateId"})}};addEventListener("message",async t=>{let e=new at(t.data);globalThis.bot=e;let n=new pn(t.data),r=Date.now();try{await e.init(),postMessage({_:"me",me:e.me})}catch(i){let s="";i instanceof se?s=i.description=="Unauthorized"?"Invalid bot token":i.description:s=String(i),s=`Authorization failed: ${s}`,postMessage({_:"error",error:s});return}e.use((i,s)=>(n.updates.put({updateId:i.update.update_id,data:i.update}),(!i.msg?.date||i.msg.date<=r)&&postMessage({_:"sound"}),s())),e.start()},{once:!0});
